---
title: 线程和锁
date: 2023-01-19 20:51:26
permalink: /pages/db2acd/
categories:
  - 《Golang并发编程》
  - 并发基础
tags:
  - 
author: 
  name: knightxv
  link: https://github.com/knightxv
---
# 线程和锁

## 线程的概念

线程有时被称为轻量级进程（ LightweightProcess , LWP )，是程序执行流的最小单元。

一个标准的线程由线程 ID 、当前指令指针（ PC )、寄存器集合和堆栈组成。另外，线程是进程中的一个实体，是被系统独立调度和分派的基本单位。线程自己不拥有系统资源，只拥有一点在运行中必不可少的资源，但它可与同属一个进程的其他线程共享进程所拥有的全部资源。

## 锁

所谓的锁，可以理解为内存中的一个整型数，拥有两种状态：空闲状态和上锁状态。加锁时，判断锁是否空闲，如果空闲，修改为上锁状态，返回成功。如果已经上锁，则返回失败解锁时，则把锁状态修改为空闲状态。

通过锁机制，能够保证在多核多线程环境中，在某一个时间点上，只能有一个线程进入临界区代码，从而保证临界区中操作数据的一致性。

## 为什么需要锁？

锁是 sync 包中的核心，它主要有两个方法，分别是加锁（ Lock ）和解锁( Unlock )。在并发的情况下，多个线程或协程同时去修改一个变量，使用锁能保证在某一时间内，只有一个协程或线程修改这一变量。不使用锁时，在并发的情况下可能无法得到想要的结果。
