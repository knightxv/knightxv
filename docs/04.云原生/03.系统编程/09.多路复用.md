---
title: 多路复用
date: 2023-02-02 20:09:05
permalink: /pages/989335/
categories:
  - 云原生
  - 系统编程
tags:
  - 
author: 
  name: knightxv
  link: https://github.com/knightxv
---
# 多路复用

## select、poll 和 epoll 之间的区别?

（1）select：时间复杂度 O(n)

select 仅仅知道有 I/O 事件发生，但并不知道是哪几个流，所以只能无差别轮询所有流，找出能读出数据或者写入数据的流，并对其进行操作。所以 select 具有 O(n) 的无差别轮询复杂度，同时处理的流越多，无差别轮询时间就越长。

（2）poll：时间复杂度 O(n)

poll 本质上和 select 没有区别，它将用户传入的数组拷贝到内核空间，然后查询每个 fd 对应的设备状态， 但是它没有最大连接数的限制，原因是它是基于链表来存储的。

（3）epoll：时间复杂度 O(1)

epoll 可以理解为 event poll，不同于忙轮询和无差别轮询，epoll 会把哪个流发生了怎样的 I/O 事件通知我们。所以说 epoll 实际上是事件驱动（每个事件关联上 fd）的。

select，poll，epoll 都是 IO 多路复用的机制。I/O 多路复用就是通过一种机制监视多个描述符，一旦某个描述符就绪（一般是读就绪或者写就绪），就通知程序进行相应的读写操作。但 select，poll，epoll 本质上都是同步 I/O，因为他们都需要在读写事件就绪后自己负责进行读写，也就是说这个读写过程是阻塞的，而异步 I/O 则无需自己负责进行读写，异步 I/O 的实现会负责把数据从内核拷贝到用户空间。

|            | **select**                                            | **poll**                                            | **epoll**                                                                                            |
| ---------- | ----------------------------------------------------- | --------------------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| 操作方式   | 遍历                                                  | 遍历                                                | 回调                                                                                                 |
| 底层实现   | 数组                                                  | 链表                                                | 红黑树                                                                                               |
| IO 效率    | 每次调用都进行线性遍历,时间复杂度 O(n)                | 每次调用都是线性遍历,时间复杂度 O(n)                | 事件通知方式,每当 fd 就绪,系统注册的回调函数就会被调用,将就绪 fd 放到 readyList 里面,时间复杂度 O(1) |
| 最大连接数 | 1024（x86）或 2048（x64）                             | 无上限                                              | 无上限                                                                                               |
| fd 拷贝    | 每次调用 select，都需要把 fd 集合从用户态拷贝到内核态 | 每次调用 poll，都需要把 fd 集合从用户态拷贝到内核态 | 调用 epoll_ctl 时拷贝进内核并保存，之后每次 epoll_wait 不拷贝(mmap 内存映射技术,降低拷贝的资源消耗)  |

## select_poll_epoll 文章详解

https://mp.weixin.qq.com/s?__biz=MzAxMTA4Njc0OQ==&mid=2651443085&idx=3&sn=2c1ed8474bc7fed68b519ce9e5f5e0b0&scene=21#wechat_redirect

https://zhuanlan.zhihu.com/p/448034877
