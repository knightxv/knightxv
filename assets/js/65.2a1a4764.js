(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{385:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"五、深入-dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、深入-dockerfile"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#%E4%BA%94%E3%80%81%E6%B7%B1%E5%85%A5dockerfile"}},[s._v("#")]),s._v(" 五、深入 Dockerfile")]),s._v(" "),a("p",[a("strong",[s._v("Dockerfile 由一行行命令语句组成，并且支持以#开头的注释行。基础的小 linux 系统。jdk； 一般而言，Dockerfile 可以分为四部分")])]),s._v(" "),a("p",[a("code",[s._v("基础镜像信息")]),s._v(" "),a("code",[s._v("维护者信息")]),s._v(" "),a("code",[s._v("镜像操作指令")]),s._v(" "),a("code",[s._v("启动时执行指令")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[s._v("指令")])]),s._v(" "),a("th",[a("strong",[s._v("说明")])])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("FROM")]),s._v(" "),a("td",[s._v("指定基础镜像")])]),s._v(" "),a("tr",[a("td",[s._v("MAINTAINER")]),s._v(" "),a("td",[s._v("指定维护者信息，已经"),a("strong",[s._v("过时")]),s._v("，可以使用 LABEL maintainer=xxx 来替代")])]),s._v(" "),a("tr",[a("td",[s._v("LABEL")]),s._v(" "),a("td",[s._v("指定维护者信息 maintainer=xxx auth=xueqimiao a=b (语法 k=v )")])]),s._v(" "),a("tr",[a("td",[s._v("RUN")]),s._v(" "),a("td",[s._v("运行命令 代表镜像构建过程中运行的命令")])]),s._v(" "),a("tr",[a("td",[s._v("CMD")]),s._v(" "),a("td",[s._v("指定启动容器时默认的命令 容器启动时要执行的命令")])]),s._v(" "),a("tr",[a("td",[s._v("ENTRYPOINT")]),s._v(" "),a("td",[s._v("指定镜像的默认入口.运行命令")])]),s._v(" "),a("tr",[a("td",[s._v("EXPOSE")]),s._v(" "),a("td",[s._v("声明镜像内服务监听的端口")])]),s._v(" "),a("tr",[a("td",[s._v("ENV")]),s._v(" "),a("td",[s._v("指定环境变量，可以在 docker run 的时候使用-e 改变 会被固话到 image 的 config 里面")])]),s._v(" "),a("tr",[a("td",[s._v("ADD")]),s._v(" "),a("td",[s._v("复制指定的 src 路径下的内容到容器中的 dest 路径下，src 可以为 url 会自动下载，可以为 tar 文件，会自动解压")])]),s._v(" "),a("tr",[a("td",[s._v("COPY")]),s._v(" "),a("td",[s._v("复制本地主机的 src 路径下的内容到镜像中的 dest 路径下，但不会自动解压等")])]),s._v(" "),a("tr",[a("td",[s._v("LABEL")]),s._v(" "),a("td",[s._v("指定生成镜像的元数据标签信息")])]),s._v(" "),a("tr",[a("td",[s._v("VOLUME")]),s._v(" "),a("td",[s._v("创建数据卷挂载点")])]),s._v(" "),a("tr",[a("td",[s._v("USER")]),s._v(" "),a("td",[s._v("指定运行容器时的用户名或 UID")])]),s._v(" "),a("tr",[a("td",[s._v("WORKDIR")]),s._v(" "),a("td",[s._v("配置工作目录，为后续的 RUN、CMD、ENTRYPOINT 指令配置工作目录")])]),s._v(" "),a("tr",[a("td",[s._v("ARG")]),s._v(" "),a("td",[s._v("指定镜像内使用的参数（如版本号信息等），可以在 build 的时候，使用--build-args 改变")])]),s._v(" "),a("tr",[a("td",[s._v("OBBUILD")]),s._v(" "),a("td",[s._v("配置当创建的镜像作为其他镜像的基础镜像是，所指定的创建操作指令")])]),s._v(" "),a("tr",[a("td",[s._v("STOPSIGNAL")]),s._v(" "),a("td",[s._v("容器退出的信号值")])]),s._v(" "),a("tr",[a("td",[s._v("HEALTHCHECK")]),s._v(" "),a("td",[s._v("健康检查")])]),s._v(" "),a("tr",[a("td",[s._v("SHELL")]),s._v(" "),a("td",[s._v("指定使用 shell 时的默认 shell 类型")])])])]),s._v(" "),a("h2",{attrs:{id:"_1、from"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、from"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_1%E3%80%81from"}},[s._v("#")]),s._v(" 1、FROM")]),s._v(" "),a("p",[a("strong",[s._v("FROM 指定基础镜像，最好挑一些 apline，slim 之类的基础小镜像.指定一个已经存在的镜像作为模板，第一条必须是 from")])]),s._v(" "),a("p",[a("strong",[s._v("scratch 镜像是一个空镜像，常用于多阶段构建")])]),s._v(" "),a("p",[a("strong",[s._v("如何确定我需要什么要的基础镜像？")])]),s._v(" "),a("ul",[a("li",[s._v("Java 应用当然是 java 基础镜像（SpringBoot 应用）或者 Tomcat 基础镜像（War 应用）")]),s._v(" "),a("li",[s._v("JS 模块化应用一般用 nodejs 基础镜像")]),s._v(" "),a("li",[s._v("其他各种语言用自己的服务器或者基础环境镜像，如 python、golang、java、php 等")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注释")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像")]),s._v("\nFROM alpine\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给镜像加标签")]),s._v("\nLABEL auth "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xueqimiao\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行的指令 默认是使用id=0的用户 也就是root 是这个基础系统的root用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 代表镜像构建过程中运行的命令")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器启动时要执行的命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像启动如果要运行很长、很多命令 可以准备一个sh文件 让镜像启动运行sh文件（大多数镜像这么操作）")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" success\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h2",{attrs:{id:"_2、label、maintainer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、label、maintainer"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_2%E3%80%81label%E3%80%81maintainer"}},[s._v("#")]),s._v(" 2、LABEL、MAINTAINER")]),s._v(" "),a("p",[s._v("标注镜像的一些说明信息。镜像维护者的姓名和邮箱地址")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("LABEL "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("multi.label1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("multi.label2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("other")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value3"')]),s._v("\nLABEL "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("multi.label1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("multi.label2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value2"')]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("other")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value3"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_3、run"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、run"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_3%E3%80%81run"}},[s._v("#")]),s._v(" 3、RUN")]),s._v(" "),a("ul",[a("li",[s._v("RUN 指令在当前镜像层顶部的新层执行任何命令，并提交结果，生成新的镜像层。")]),s._v(" "),a("li",[s._v("生成的提交映像将用于 Dockerfile 中的下一步。 分层运行 RUN 指令并生成提交符合 Docker 的核心概念，就像源代码控制一样。")]),s._v(" "),a("li",[s._v("exec 形式可以避免破坏 shell 字符串，并使用不包含指定 shell 可执行文件的基本映像运行 RUN 命令。可以使用 SHELL 命令更改 shell 形式的默认 shell。 在 shell 形式中，您可以使用\\（反斜杠）将一条 RUN 指令继续到下一行")]),s._v(" "),a("li",[s._v("RUN 是在 docker build 时运行")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# shell格式")]),s._v("\nRUN yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exec格式")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"可执行文件"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"参数1"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"参数2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --no-cache 不使用缓存构建")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build --no-cache  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" myalpine:v111 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" D2 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不可以引用多个")]),s._v("\nFROM alpine\nLABEL auth "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xueqimiao\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定构建参数")]),s._v("\nARG "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("aaa")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bbb\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定环境变量")]),s._v("\nENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("parm")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xue\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# shell 形式 bash -c "echo 111 "')]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$parm")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以取到 ARG")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$aaa")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exec 形式 $parm 默认取不到 取不出环境变量【ENV】，ARG也取不到")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$parm")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# RUN ["echo","$aaa"]')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 都是可以启动容器的命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CMD sleep 1;echo $parm;echo $aaa")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 都是可以启动容器的命令")]),s._v("\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$parm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$aaa")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("RUN "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("command"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" shell 形式, /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" 的方式运行，避免破坏shell字符串"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" 形式"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nRUN /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'source $HOME/.bashrc; \necho $HOME'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上面等于下面这种写法")]),s._v("\nRUN /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'source $HOME/.bashrc; echo $HOME'")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试案例")]),s._v("\nFROM alpine\nLABEL "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maintainer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xueqimiao "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("aa\nENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hello xueqimiao'")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$msg")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$msg")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nRUN /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo $msg'")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$msg")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("blockquote",[a("p",[s._v("总结； 由于[]不是 shell 形式，所以不能输出变量信息，而是输出$msg。其他任何/bin/sh -c 的形式都")]),s._v(" "),a("p",[s._v("可以输出变量信息")]),s._v(" "),a("p",[s._v("总结：什么是 shell 和 exec 形式")]),s._v(" "),a("ol",[a("li",[s._v("shell 是 /bin/sh -c <command>的方式，")]),s._v(" "),a("li",[s._v('exec ["/bin/sh","-c",command] 的方式== shell 方式')])]),s._v(" "),a("p",[s._v("也就是 exec 默认方式不会进行变量替换")])]),s._v(" "),a("h2",{attrs:{id:"_4、cmd-和-entrypoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、cmd-和-entrypoint"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_4%E3%80%81cmd%E5%92%8Centrypoint"}},[s._v("#")]),s._v(" 4、CMD 和 ENTRYPOINT")]),s._v(" "),a("h3",{attrs:{id:"_1、都可以作为容器启动入口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、都可以作为容器启动入口"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_1%E3%80%81%E9%83%BD%E5%8F%AF%E4%BB%A5%E4%BD%9C%E4%B8%BA%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E5%85%A5%E5%8F%A3"}},[s._v("#")]),s._v(" 1、都可以作为容器启动入口")]),s._v(" "),a("p",[s._v("CMD 的三种写法：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("CMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" 方式, 首选方式"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("为ENTRYPOINT提供默认参数"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" param1 param2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" shell 形式"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ENTRYPOINT 的两种写法：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" 方式, 首选方式"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" param1 param2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shell 形式"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一个示例")]),s._v("\nFROM alpine\nLABEL "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maintainer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xueqimiao\n\nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1111"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2222"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建出如上镜像后测试")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run xxxx：效果 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"_2、只能有一个-cmd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、只能有一个-cmd"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_2%E3%80%81%E5%8F%AA%E8%83%BD%E6%9C%89%E4%B8%80%E4%B8%AAcmd"}},[s._v("#")]),s._v(" 2、只能有一个 CMD")]),s._v(" "),a("ul",[a("li",[s._v("Dockerfile 中只能有一条 CMD 指令。 如果您列出多个 CMD，则只有最后一个 CMD 才会生效。")]),s._v(" "),a("li",[s._v("CMD 的主要目的是为执行中的容器提供默认值。 这些默认值可以包含可执行文件，也可以省略可执行文件，在这种情况下，您还必须指定 ENTRYPOINT 指令。")]),s._v(" "),a("li",[s._v("CMD 会被 docker run 之后的参数替换")]),s._v(" "),a("li",[s._v("CMD 是在 docker run 时运行。")]),s._v(" "),a("li",[s._v("RUN 是在 docker build 时运行。")]),s._v(" "),a("li",[s._v("类似于 CMD 指令，但是 ENTRYPOINT 不会被 docker run 后面的命令覆盖，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序")]),s._v(" "),a("li",[s._v("在执行 docker run 的时候可以指定 ENTRYPOINT 运行所需的参数。")]),s._v(" "),a("li",[s._v("如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效")])]),s._v(" "),a("h3",{attrs:{id:"_3、cmd-为-entrypoint-提供默认参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、cmd-为-entrypoint-提供默认参数"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_3%E3%80%81cmd%E4%B8%BAentrypoint%E6%8F%90%E4%BE%9B%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0"}},[s._v("#")]),s._v(" 3、CMD 为 ENTRYPOINT 提供默认参数")]),s._v(" "),a("p",[s._v("如果使用 CMD 为 ENTRYPOINT 指令提供默认参数，则 CMD 和 ENTRYPOINT 指令均应使用 JSON 数组格式指定。")]),s._v(" "),a("p",[s._v("ENTRYPOINT 可以和 CMD 一起用，一般是 变参 才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参。")]),s._v(" "),a("p",[s._v("当指定了 ENTRYPOINT 后，CMD 的含义就发生了变化，不再是直接运行其命令而是将 CMD 的内容作为参数传递给 ENTRYPOINT 指令，他两个组合会变成 <ENTRYPOINT><CMD>")]),s._v(" "),a("p",[s._v("假设已通过 Dockerfile 构建了 nginx:test 镜像 ：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v("] # 定参")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/nginx/nginx.conf"')]),s._v("] # 变参")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[s._v("是否传参")]),s._v(" "),a("th",[s._v("安装 dockerfile 编写执行")]),s._v(" "),a("th",[s._v("传参运行")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("Docker 命令")]),s._v(" "),a("td",[s._v("docker run nginx:test")]),s._v(" "),a("td",[s._v("docker run nginx:test /etc/nginx/"),a("strong",[s._v("nginxnew.conf")])])]),s._v(" "),a("tr",[a("td",[s._v("实际命令")]),s._v(" "),a("td",[s._v("nginx -c /etc/nginx/nginx.conf")]),s._v(" "),a("td",[s._v("nginx -c /etc/nginx/"),a("strong",[s._v("nginxnew.conf")])])])])]),s._v(" "),a("h3",{attrs:{id:"_4、组合最终效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、组合最终效果"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_4%E3%80%81%E7%BB%84%E5%90%88%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C"}},[s._v("#")]),s._v(" 4、组合最终效果")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ENTRYPOINT ping baidu.com 怎么写都没用，容器启动都是以ENTRYPOINT的完整命令为准\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM alpine\nENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("baidu.com\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# CMD ["ping","baidu.com"]')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# CMD ["useradd","-u","1000","-g","2000"]')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# CMD ["ping","${url}"]  取不出变量')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CMD ping ${url}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方都是建议使用 []方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# CMD ["/bin/sh","-c","ping ${url}"]')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ENTRYPOINT ping baidu.com + CMD怎么写都没用，容器启动都是以ENTRYPOINT的完整命令为准")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# java -jar xxxx.jar --spring.profile=dev --server.port=8888")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这两个合在一起不能是错误的命令")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#官方推荐的写法,，变化的写CMD，而CMD是提供参数给ENTRYPOINT")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run imageName  cmd1  一旦传递了cmd1，CMD指定的所有参数都会被覆盖，")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自定义参数的情况下一定要传完")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"baidu.com"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#exec的写法 不变的写 ENTRYPOINT；未来他是容器启动的唯一入口，")]),s._v("\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ping"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h3",{attrs:{id:"_5、docker-run-启动参数会覆盖-cmd-内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、docker-run-启动参数会覆盖-cmd-内容"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_5%E3%80%81docker-run%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0%E4%BC%9A%E8%A6%86%E7%9B%96cmd%E5%86%85%E5%AE%B9"}},[s._v("#")]),s._v(" 5、docker run 启动参数会覆盖 CMD 内容")]),s._v(" "),a("blockquote",[a("p",[s._v("# 一个示例")]),s._v(" "),a("p",[s._v("FROM alpine")]),s._v(" "),a("p",[s._v("LABEL maintainer=xueqimiao")]),s._v(" "),a("p",[s._v('CMD ["1111"]')]),s._v(" "),a("p",[s._v('ENTRYPOINT ["echo"]')]),s._v(" "),a("p",[s._v("#构建出如上镜像后测试")]),s._v(" "),a("p",[s._v("docker run xxxx：什么都不传则 echo 1111")]),s._v(" "),a("p",[s._v("docker run xxx arg1：传入 arg1 则 echo arg1")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM alpine\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ENTRYPOINT: 入口（真正的门）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ENTRYPOINT [ "ping" ]')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 命令（进门的时候带口令）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最终的用法: CMD是给ENTRYPOINT提供参数的")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CMD可以被修改")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CMD ping baidu.com")]),s._v("\n\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" baidu.com\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ENTRYPOINT + CMD = 容器的完整启动命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这是启动命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ENTRYPOINT ping + CMD baidu.com = 错误")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多个CMD只有最后一次生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CMD ping baidu.com")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ["echo","${param}"] 不是bash -c的方式，取不出环境变量信息')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo $param     = ["/bin/sh","-c","多长的命令都写在这里  echo ${param}"]')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ENTRYPOINT或者CMD作为唯一入口，只能写一个，最后一个生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ENTRYPOINT ping baidu.com")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN，CMD，ENTRYPOINT")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# []:  ["/bin/sh","-c"] = shell')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# shell:")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h2",{attrs:{id:"_5、arg-和-env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、arg-和-env"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_5%E3%80%81arg%E5%92%8Cenv"}},[s._v("#")]),s._v(" 5、ARG 和 ENV")]),s._v(" "),a("h3",{attrs:{id:"_1、arg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、arg"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_1%E3%80%81arg"}},[s._v("#")]),s._v(" 1、ARG")]),s._v(" "),a("ul",[a("li",[s._v("ARG 指令定义了一个变量，用户可以在构建时使用--build-arg = 传递，docker build 命令会将其传递给构建器。")]),s._v(" "),a("li",[s._v("--build-arg 指定参数会覆盖 Dockerfile 中指定的同名参数")]),s._v(" "),a("li",[s._v("如果用户指定了 未在 Dockerfile 中定义的构建参数 ，则构建会输出 警告 。")]),s._v(" "),a("li",[s._v("ARG 只在构建期有效，运行期无效")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker build --no-cache --build-arg version=3.13.4 demo:test -f D2 .")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以动态传入版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以在任意位置定义 并在以后取值使用")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ARG version=latest")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#FROM alpine:$version")]),s._v("\nFROM alpine\nLABEL maintainer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xueqimiao\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义以后的剩下环节生效 不包括运行时")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以在构建时进行变化，docker build 时")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ARG 不像 env 不能并排写")]),s._v("\nARG "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("param")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("222")]),s._v("\nARG "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建时传入ARG")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker build --no-cache --build-arg param=333 --build-arg msg=xue -t demo:test -f D2 .")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建时期会运行的指令(根据Dockerfile创建一个镜像的整个过程时期)")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$param")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$msg")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行时期我们会运行的指令（根据之前创建的镜像启动一个容器，容器启动默认运行的命令）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CMD echo 1111;echo $param")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CMD ENTRYPOINT 都是指定的运行时的指令")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo 1111;echo '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$param")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h3",{attrs:{id:"_2、env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、env"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_2%E3%80%81env"}},[s._v("#")]),s._v(" 2、ENV")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM alpine\nLABEL maintainer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xueqimiao\n\nARG "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("param")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("222")]),s._v("\nARG "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建期 + 运行期都生效 只能在运行期进行修改")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 怎么修改")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建期 不能改env的值")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行期 docker run -e app=xue_docker2 demo:test")]),s._v("\nENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xue_docker\n\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$param")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$msg")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$app")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行时期我们会运行的指令（根据之前创建的镜像启动一个容器，容器启动默认运行的命令）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CMD echo 1111;echo $param")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CMD ENTRYPOINT 都是指定的运行时的指令")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo 1111;echo '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$param")]),s._v(";echo app_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${app}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("ul",[a("li",[s._v("在构建阶段中所有后续指令的环境中使用，并且在许多情况下也可以内联替换。")]),s._v(" "),a("li",[s._v("引号和反斜杠可用于在值中包含空格。")]),s._v(" "),a("li",[s._v("ENV 可以使用 key value 的写法，但是这种不建议使用了，后续版本可能会删除")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ENV MY_MSG hello\nENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MY_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"John Doe"')]),s._v("\nENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MY_DOG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Rex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" The"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" Dog\nENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MY_CAT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fluffy\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多行写法如下")]),s._v("\nENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MY_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"John Doe"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MY_DOG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Rex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" The"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" Dog "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MY_CAT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fluffy\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ul",[a("li",[s._v("docker run --env 可以修改这些值")]),s._v(" "),a("li",[s._v("容器运行时 ENV 值可以生效")]),s._v(" "),a("li",[s._v("ENV 在 image 阶段就会被解析并持久化（docker inspect image 查看），参照下面示例")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" alpine")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" arg=1111111")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" runcmd="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$runcmd")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$runcmd")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 改变arg，会不会改变 echo的值，会改变哪些值，如果修改这些值?")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_3、综合测试示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、综合测试示例"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_3%E3%80%81%E7%BB%BC%E5%90%88%E6%B5%8B%E8%AF%95%E7%A4%BA%E4%BE%8B"}},[s._v("#")]),s._v(" 3、综合测试示例")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM alpine\nARG "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arg1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22222")]),s._v("\nENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arg2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111111")]),s._v("\nENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("runcmd")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg1")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$runcmd")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$runcmd")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_4、env-的坑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、env-的坑"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_4%E3%80%81env%E7%9A%84%E5%9D%91"}},[s._v("#")]),s._v(" 4、ENV 的坑")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ENV的坑")]),s._v("\nFROM alpine\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ARG msg=hello")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ENV 肯定能引用ARG的参数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ENV name=${msg}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RUN echo ${msg}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RUN echo ${name}")]),s._v("\nENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msg1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hello\nENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msg2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$msg1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以上构建期间就已经确定好值了")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${msg1}")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${msg2}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# msg1=msg2 没问题")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果运行期修改msg1的值")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -it -e msg1=6666 demo:test")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 结果输出 msg1的值会改变 msg2的值是不会改变的 msg2还是hello")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 原因：docker build 的时候 env环境的信息会固话 直接在镜像配置里面就已经写死")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -e 只能修改当前env本身")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行期间能使用ENV 是因为ENV 固化到了镜像的配置")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${msg1}")]),s._v(";echo "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${msg1}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h2",{attrs:{id:"_6、add-和-copy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、add-和-copy"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_6%E3%80%81add%E5%92%8Ccopy"}},[s._v("#")]),s._v(" 6、ADD 和 COPY")]),s._v(" "),a("h3",{attrs:{id:"_1、copy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、copy"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_1%E3%80%81copy"}},[s._v("#")]),s._v(" 1、COPY")]),s._v(" "),a("p",[s._v("COPY 的两种写法")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("COPY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--chown"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("group"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dest"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nCOPY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--chown"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("group"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<src>"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<dest>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("--chown 功能仅在用于构建 Linux 容器的 Dockerfiles 上受支持，而在 Windows 容器上不起作用")]),s._v(" "),a("li",[s._v("COPY 指令从 src 复制新文件或目录，并将它们添加到容器的文件系统中，路径为 dest 。")]),s._v(" "),a("li",[s._v("可以指定多个 src 资源，但是文件和目录的路径将被解释为相对于构建上下文的源。")]),s._v(" "),a("li",[s._v("每个 src 都可以包含通配符，并且匹配将使用 Go 的 filepath.Match 规则进行。")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("COPY hom* /mydir/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当前上下文，以home开始的所有资源")]),s._v("\nCOPY hom?.txt /mydir/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ?匹配单个字符")]),s._v("\nCOPY test.txt relativeDir/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目标路径如果设置为相对路径，则相对与 WORKDIR 开始")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把 “test.txt” 添加到 <WORKDIR>/relativeDir/")]),s._v("\n\nCOPY test.txt /absoluteDir/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#也可以使用绝对路径，复制到容器指定位置")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所有复制的新文件都是uid(0)/gid(0)的用户，可以使用--chown改变")]),s._v("\nCOPY "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--chown")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v(":mygroup files* /somedir/\nCOPY "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--chown")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bin files* /somedir/\nCOPY "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--chown")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" files* /somedir/\nCOPY "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--chown")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":11 files* /somedir/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"_2、add"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、add"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_2%E3%80%81add"}},[s._v("#")]),s._v(" 2、ADD")]),s._v(" "),a("p",[s._v("同 COPY 用法，不过 ADD 拥有自动下载远程文件和解压的功能。")]),s._v(" "),a("p",[s._v("注意：")]),s._v(" "),a("ul",[a("li",[s._v("src 路径必须在构建的上下文中； 不能使用 ../something /something 这种方式，因为 docker 构建的第一步是将上下文目录（和子目录）发送到 docker 守护程序。")]),s._v(" "),a("li",[s._v("如果 src 是 URL，并且 dest 不以斜杠结尾，则从 URL 下载文件并将其复制到 dest 。")]),s._v(" "),a("li",[a("ul",[a("li",[s._v("如果 dest 以斜杠结尾，将自动推断出 url 的名字（保留最后一部分），保存到 dest")])])]),s._v(" "),a("li",[s._v("如果 src 是目录，则将复制目录的整个内容，包括文件系统元数据。")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM alpine\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把上下文指定的内容添加到镜像中 如果是压缩包 自动解压 如果是远程文件 自动下载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把当前内容复制到 这个 alpine 小系统里面 /dest")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果是远程文件 自动下载 如果下载的还是压缩包 不会自动解压")]),s._v("\nADD https://download.redis.io/releases/redis-6.2.4.tar.gz /dest/\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN 指令并没有上下文关系 RUN cd /dest RUN ls 这样还是在跟目录下 并不是进入了dest 再ls")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /dest\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前还是列举的根目录")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /dest "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM alpine\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地linux系统的文件添加进去 【宿主机到镜像内】")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://download.redis.io/releases/redis-6.2.4.tar.gz")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动解压")]),s._v("\nADD *.tar.gz /app/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# COPY *.tar.gz /app/")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"_7、workdir-和-volume"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、workdir-和-volume"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_7%E3%80%81workdir%E5%92%8Cvolume"}},[s._v("#")]),s._v(" 7、WORKDIR 和 VOLUME")]),s._v(" "),a("h3",{attrs:{id:"_1、workdir"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、workdir"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_1%E3%80%81workdir"}},[s._v("#")]),s._v(" 1、WORKDIR")]),s._v(" "),a("ul",[a("li",[s._v("指定在创建容器后，终端默认登陆的进来工作目录，一个落脚点")]),s._v(" "),a("li",[s._v("WORKDIR 指令为 Dockerfile 中跟随它的所有 RUN，CMD，ENTRYPOINT，COPY，ADD 指令设置工作目录。 如果 WORKDIR 不存在，即使以后的 Dockerfile 指令中未使用它也将被创建。")]),s._v(" "),a("li",[s._v("WORKDIR 指令可在 Dockerfile 中多次使用。 如果提供了相对路径，则它将相对于上一个 WORKDIR 指令的路径。 例如：")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("WORKDIR /a\nWORKDIR b\nWORKDIR c\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#结果 /a/b/c")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("也可以用到环境变量")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DIRPATH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path\nWORKDIR "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DIRPATH")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DIRNAME")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#结果 /path/$DIRNAME")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM alpine\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为以下所有的命令运行指定了基础目录")]),s._v("\nWORKDIR /app\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以为进入容器指定一个默认目录")]),s._v("\nWORKDIR abc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##比如我们的nginx镜像可以做成这样")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#WORKDIR /usr/share/nginx/html")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /app/abc  多个WORKDIR可以嵌套")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#复制到当前目录下")]),s._v("\nCOPY *.txt   ./\nRUN  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" baidu.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM nginx\nWORKDIR /usr/share/nginx/html\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2、volume"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、volume"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_2%E3%80%81volume"}},[s._v("#")]),s._v(" 2、VOLUME")]),s._v(" "),a("p",[s._v("作用：把容器的某些文件夹映射到主机外部")]),s._v(" "),a("p",[s._v("写法：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('VOLUME ["/var/log/"]  #可以是JSON数组\nVOLUME /var/log  #可以直接写\nVOLUME /var/log /var/db #可以空格分割多个\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("注意：")]),s._v(" "),a("p",[s._v("用 VOLUME 声明了卷，那么以后对于卷内容的修改会被丢弃，所以， 一定在 volume 声明之前修改内容 ；")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM alpine\n\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /hello "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /app\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /hello/a.txt\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("222")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /app/b.txt\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载 容器内指定的文件夹 不存在会创建")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定了 VOLUME ,即使启动容器没有指定 -v 参数，我们也会自动进行匿名卷挂载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器内的 /hello ，/app 文件夹，请你在使用镜像启动容器的时候，自动给宿主机上挂载")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# VOLUME挂载出去的东西，容器改变也不会最终commit的时候生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -v 使用 VOLUME和-v挂载出去的目录（外面变，容器里面变）。所有改变也生效了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1）、但是 docker commit 提交当前容器的所有变化为镜像的时候，就会丢弃")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 2）、VOLUME [ "/hello","/app" ] 容器以后自动挂载，在Dockerfile中对VOLUME的所有修改都不生效 要想生效 可以在声明挂载之前修改')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3）、挂载只有一点就是方便在外面修改，或者把外面的东西直接拿过来")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所以这个写在最后")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JAVA 日志都要挂外面 /app/log")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# VOLUME ["/log"]')]),s._v("\nVOLUME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hello"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这两句话没有生效")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6666")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /hello/a.txt\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /app/b.txt\nCMD "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" baidu.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h2",{attrs:{id:"_8、user"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、user"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_8%E3%80%81user"}},[s._v("#")]),s._v(" 8、USER")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM alpine\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN adduser -u 1000 -g 1000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以后的所有命令会用 abc:abc 来执行。有可能没有执行权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器中的ROOT虽然不是linux宿主机的真实root，但是可以改掉这个镜像的所有")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(":1000\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把复制来的文件给用户所有权")]),s._v("\nCOPY "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--chown")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(":1000   *.txt   /a.txt\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" /\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不是root不能写")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2222")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" a.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("USER &lt;user>[:&lt;group>]\nUSER &lt;UID>[:&lt;GID>]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("USER 指令设置运行映像时要使用的用户名（或 UID）以及可选的用户组（或 GID），以及 Dockerfile 中 USER 后面所有 RUN，CMD 和 ENTRYPOINT 指令。")])]),s._v(" "),a("h2",{attrs:{id:"_9、expose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9、expose"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_9%E3%80%81expose"}},[s._v("#")]),s._v(" 9、EXPOSE")]),s._v(" "),a("ul",[a("li",[s._v("EXPOSE 指令通知 Docker 容器在运行时在指定的网络端口上进行侦听。 可以指定端口是侦听 TCP 还是 UDP，如果未指定协议，则默认值为 TCP。")]),s._v(" "),a("li",[s._v("EXPOSE 指令实际上不会发布端口。 它充当构建映像的人员和运行容器的人员之间的一种文档，即有关打算发布哪些端口的信息。 要在运行容器时实际发布端口，请在 docker run 上使用-p 标志发布并映射一个或多个端口，或使用-P 标志发布所有公开的端口并将其映射到高阶端口。")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("EXPOSE &lt;port> [&lt;port>/&lt;protocol>...]\nEXPOSE [80,443]\nEXPOSE 80/tcp\nEXPOSE 80/udp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM alpine\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露 ，这个只是一个声明；给程序员看。docker也能看到")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker -d -P（随机分配端口，）")]),s._v("\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" baidu.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"_10、自动以-nginx-镜像安装-vim"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10、自动以-nginx-镜像安装-vim"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_10%E3%80%81%E8%87%AA%E5%8A%A8%E4%BB%A5nginx%E9%95%9C%E5%83%8F%E5%AE%89%E8%A3%85vim"}},[s._v("#")]),s._v(" 10、自动以 Nginx 镜像安装 vim")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装vim编辑器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update && apt-get install vim -y")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_11、自定义镜像-mycentosjava8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11、自定义镜像-mycentosjava8"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_11%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8Fmycentosjava8"}},[s._v("#")]),s._v(" 11、自定义镜像 mycentosjava8")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 要求:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Centos7镜像具备vim+ifconfig+jdk8")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## jdk下载地址：https://www.oracle.com/java/technologies/downloads/#java8")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## jdk的包和Dockerfile放到同一目录")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" xue<xueqimiao@163.com>")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MYPATH /usr/local")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYPATH")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装vim编辑器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum -y install vim")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装ifconfig命令查看网络IP")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum -y install net-tools")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装java8及lib库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum -y install glibc.i686")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir /usr/local/java")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ADD 是相对路径jar,把jdk-8u171-linux-x64.tar.gz添加到容器中,安装包必须要和Dockerfile文件在同一位置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" jdk-8u171-linux-x64.tar.gz /usr/local/java/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置java环境变量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" JAVA_HOME /usr/local/java/jdk1.8.0_171")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" JRE_HOME "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/jre")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" CLASSPATH "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/lib/dt.jar:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/lib/tools.jar:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JRE_HOME")]),s._v("/lib:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CLASSPATH")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PATH "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/bin:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PATH")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYPATH")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success--------------ok"')])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" /bin/bash")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" centosjava8:1.5 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意，上面TAG后面有个空格，有个点")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" 新镜像名字:TAG\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" centosjava8:1.5 /bin/bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚悬镜像")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 仓库名、标签都是<none>的镜像，俗称dangling image")]),s._v("\n\nfrom ubuntu\nCMD "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'action is success'")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dangling")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);