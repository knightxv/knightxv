(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{359:function(s,a,t){"use strict";t.r(a);var e=t(4),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"redis-集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-集群"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#redis%E9%9B%86%E7%BE%A4"}},[s._v("#")]),s._v(" Redis 集群")]),s._v(" "),a("h2",{attrs:{id:"_1、主从复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、主从复制"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_1%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"}},[s._v("#")]),s._v(" 1、主从复制")]),s._v(" "),a("h3",{attrs:{id:"_1、是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、是什么"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_1%E3%80%81%E6%98%AF%E4%BB%80%E4%B9%88"}},[s._v("#")]),s._v(" 1、是什么")]),s._v(" "),a("blockquote",[a("p",[s._v("主机数据更新后根据配置和策略， 自动同步到备机的"),a("code",[s._v("master/slaver机制，Master以写为主，Slave以读为主")])])]),s._v(" "),a("h3",{attrs:{id:"_2、能干嘛"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、能干嘛"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_2%E3%80%81%E8%83%BD%E5%B9%B2%E5%98%9B"}},[s._v("#")]),s._v(" 2、能干嘛")]),s._v(" "),a("ul",[a("li",[s._v("读写分离，性能扩展")]),s._v(" "),a("li",[s._v("容灾快速恢复")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/4aafa956be7441c29ca4302fa4886b3e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeGlhb3h1ZUB4dWUuY29t,size_7,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"_3、配置主从复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、配置主从复制"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_3%E3%80%81%E9%85%8D%E7%BD%AE%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"}},[s._v("#")]),s._v(" 3、配置主从复制")]),s._v(" "),a("h4",{attrs:{id:"_1、新建-3-个配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、新建-3-个配置文件"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_1%E3%80%81%E6%96%B0%E5%BB%BA3%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"}},[s._v("#")]),s._v(" 1、新建 3 个配置文件")]),s._v(" "),a("ul",[a("li",[s._v("这里只在一台机器上模拟 不同端口 多台机器效果一样")]),s._v(" "),a("li",[s._v("使用到了之前 /myredis/redis.conf 配置文件")]),s._v(" "),a("li",[s._v("redis6379.conf")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("include /myredis/redis.conf\npidfile /var/run/redis_6379.pid\nport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\ndbfilename dump6379.rdb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("redis6380.conf")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("include /myredis/redis.conf\npidfile /var/run/redis_6380.pid\nport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6380")]),s._v("\ndbfilename dump6380.rdb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("redis6381.conf")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("include /myredis/redis.conf\npidfile /var/run/redis_6381.pid\nport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6381")]),s._v("\ndbfilename dump6381.rdb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("可以加这个配置 slave-priority 10")]),s._v(" "),a("li",[s._v("设置从机的优先级，值越小，优先级越高，用于选举主机时使用。默认 100")])]),s._v(" "),a("h3",{attrs:{id:"_4、启动-3-台机器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、启动-3-台机器"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_4%E3%80%81%E5%90%AF%E5%8A%A83%E5%8F%B0%E6%9C%BA%E5%99%A8"}},[s._v("#")]),s._v(" 4、启动 3 台机器")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("redis-server /myredis/redis6379.conf\nredis-server /myredis/redis6380.conf\nredis-server /myredis/redis6381.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/2bc693e76c564f05965b9991cf5898be.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/3d2fcb7de27b41e1b178e0993f1bde1b.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"_5、查看三台主机运行情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、查看三台主机运行情况"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_5%E3%80%81%E6%9F%A5%E7%9C%8B%E4%B8%89%E5%8F%B0%E4%B8%BB%E6%9C%BA%E8%BF%90%E8%A1%8C%E6%83%85%E5%86%B5"}},[s._v("#")]),s._v(" 5、查看三台主机运行情况")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据端口连接客户端")]),s._v("\nredis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/efc3deeee5d14c77bfb2b02012e3c5f1.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打印主从复制的相关信息")]),s._v("\ninfo replication\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/1e31e8a994f84788bd1fe17b391fa457.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeGlhb3h1ZUB4dWUuY29t,size_16,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("ul",[a("li",[s._v("可以连接三台都看一下")]),s._v(" "),a("li",[s._v("可以发现每台都是 master")]),s._v(" "),a("li",[s._v("因为还没有加入集群")])]),s._v(" "),a("h3",{attrs:{id:"_6、配从-库-不配主-库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、配从-库-不配主-库"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_6%E3%80%81%E9%85%8D%E4%BB%8E-%E5%BA%93-%E4%B8%8D%E9%85%8D%E4%B8%BB-%E5%BA%93"}},[s._v("#")]),s._v(" 6、配从(库)不配主(库)")]),s._v(" "),a("ul",[a("li",[s._v("在 6380 和 6381 上执行")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/712fb833c12b45bfae0321cf8233e553.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/3b69bab83bf2469fbcadbfc08045c044.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("ul",[a("li",[s._v("再看 6379")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/2d90429fbfa642a283b86c2240c5ab96.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeGlhb3h1ZUB4dWUuY29t,size_17,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("ul",[a("li",[s._v("master 写数据")]),s._v(" "),a("li",[s._v("从机获取数据")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/71f40e30b0c64e25b1b3ef78dcbb7a3e.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("ul",[a("li",[s._v("从机上写数据报错")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/6555a4d897da4733861071d8642ac304.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("ul",[a("li",[s._v("关掉 master")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/0c7e3a65134b4a8db90b72e47d217756.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("启动 master")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("redis-server /myredis/redis6379.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/cfdcf1d87a9743c4af6943a129ffc9bf.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeGlhb3h1ZUB4dWUuY29t,size_18,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("ul",[a("li",[s._v("主机挂掉，重启就行，一切如初")]),s._v(" "),a("li",[s._v("从机重启需重设：slaveof 127.0.0.1 6379")]),s._v(" "),a("li",[s._v("可以将配置增加到文件中。永久生效。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/6c10a8dd8f0b4f49b84bd0387ad74173.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("redis-server /myredis/redis6380.conf\ninfo replication\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/34c2012cfd024944b96361cd8a84a37f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeGlhb3h1ZUB4dWUuY29t,size_18,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("ul",[a("li",[s._v("自己变成独立的机器了")])]),s._v(" "),a("h3",{attrs:{id:"_7、自己测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、自己测试"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_7%E3%80%81%E8%87%AA%E5%B7%B1%E6%B5%8B%E8%AF%95"}},[s._v("#")]),s._v(" 7、自己测试")]),s._v(" "),a("ul",[a("li",[s._v("切入点问题？slave1、slave2 是从头开始复制还是从切入点开始复制?比如从 k4 进来，那之前的 k1,k2,k3 是否也可以复制？")]),s._v(" "),a("li",[s._v("从机是否可以写？set 可否？")]),s._v(" "),a("li",[s._v("主机 shutdown 后情况如何？从机是上位还是原地待命？")]),s._v(" "),a("li",[s._v("主机又回来了后，主机新增记录，从机还能否顺利复制？")]),s._v(" "),a("li",[s._v("其中一台从机 down 后情况如何？依照原有它能跟上大部队吗？")])]),s._v(" "),a("h3",{attrs:{id:"_8、复制原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、复制原理"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_8%E3%80%81%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86"}},[s._v("#")]),s._v(" 8、复制原理")]),s._v(" "),a("ul",[a("li",[s._v("Slave 启动成功连接到 master 后会发送一个 sync 命令")]),s._v(" "),a("li",[s._v("Master 接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令， 在后台进程执行完毕之后，master 将传送整个数据文件到 slave,以完成一次完全同步")]),s._v(" "),a("li",[s._v("全量复制：而 slave 服务在接收到数据库文件数据后，将其存盘并加载到内存中。")]),s._v(" "),a("li",[s._v("增量复制：Master 继续将新的所有收集到的修改命令依次传给 slave,完成同步")]),s._v(" "),a("li",[s._v("但是只要是重新连接 master,一次完全同步（全量复制)将被自动执行")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/4d5bd149e5a8470f97b1de842da8c863.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"_9、哨兵模式-sentinel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9、哨兵模式-sentinel"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_9%E3%80%81%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F-sentinel"}},[s._v("#")]),s._v(" 9、哨兵模式(sentinel)")]),s._v(" "),a("h4",{attrs:{id:"_1、是什么-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、是什么-2"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_1%E3%80%81%E6%98%AF%E4%BB%80%E4%B9%88-2"}},[s._v("#")]),s._v(" 1、是什么")]),s._v(" "),a("ul",[a("li",[s._v("能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/bb58d7f018414a28ae4ac10b2affef98.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeGlhb3h1ZUB4dWUuY29t,size_7,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("h4",{attrs:{id:"_2、配置步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、配置步骤"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_2%E3%80%81%E9%85%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4"}},[s._v("#")]),s._v(" 2、配置步骤")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("/myredis 目录下新建 sentinel.conf 文件，名字绝不能错")])]),s._v(" "),a("li",[a("p",[s._v("配置哨兵,填写内容")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("sentinel monitor mymaster "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("其中 mymaster 为监控对象起的服务器名称， 1 为至少有多少个哨兵同意迁移的数量。")])]),s._v(" "),a("li",[a("p",[s._v("启动哨兵")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/usr/local/bin 目录下有 redis-sentinel\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入以下命令启动即可")]),s._v("\nredis-sentinel  /myredis/sentinel.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/0c11be3f32d0410fa49ca99da0f994e1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeGlhb3h1ZUB4dWUuY29t,size_20,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("杀掉主机，当主机挂掉，从机选举中产生新的主机")])]),s._v(" "),a("li",[a("p",[s._v("(大概 10 秒左右可以看到哨兵窗口日志，切换了新的主机)")]),s._v(" "),a("p",[s._v("哪个从机会被选举为主机呢？根据优先级别：slave-priority")]),s._v(" "),a("p",[s._v("原主机重启后会变为从机。")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/82900694e19341ea88e5c98680c00832.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h4",{attrs:{id:"_3、复制延时"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、复制延时"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_3%E3%80%81%E5%A4%8D%E5%88%B6%E5%BB%B6%E6%97%B6"}},[s._v("#")]),s._v(" 3、复制延时")]),s._v(" "),a("p",[s._v("​ 由于所有的写操作都是先在 Master 上操作，然后同步更新到 Slave 上，所以从 Master 同步到 Slave 机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，Slave 机器数量的增加也会使这个问题更加严重。")]),s._v(" "),a("h3",{attrs:{id:"_10、故障恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10、故障恢复"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_10%E3%80%81%E6%95%85%E9%9A%9C%E6%81%A2%E5%A4%8D"}},[s._v("#")]),s._v(" 10、故障恢复")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/d05c0b39f85b49d7958c95f3a31a68eb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeGlhb3h1ZUB4dWUuY29t,size_12,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("ul",[a("li",[s._v("优先级在 redis.conf 中默认：slave-priority 100，值越小优先级越高")]),s._v(" "),a("li",[s._v("偏移量是指获得原主机数据最全的")]),s._v(" "),a("li",[s._v("每个 redis 实例启动后都会随机生成一个 40 位的 runid")])]),s._v(" "),a("h3",{attrs:{id:"_11、主从复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11、主从复制"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_11%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"}},[s._v("#")]),s._v(" 11、主从复制")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisSentinelPool")]),s._v(" jedisSentinelPool "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getJedisFromSentinel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jedisSentinelPool "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" sentinelSet "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashSet")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            sentinelSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.11.103:26379"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisPoolConfig")]),s._v(" jedisPoolConfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisPoolConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMaxTotal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//最大可用连接数")]),s._v("\n            jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMaxIdle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//最大闲置连接数")]),s._v("\n            jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMinIdle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//最小闲置连接数")]),s._v("\n            jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setBlockWhenExhausted")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//连接耗尽是否等待")]),s._v("\n            jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMaxWaitMillis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//等待时间")]),s._v("\n            jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTestOnBorrow")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//取连接的时候进行一下测试 ping pong")]),s._v("\n\n            jedisSentinelPool "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisSentinelPool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mymaster"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sentinelSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" jedisSentinelPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" jedisSentinelPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("111111111122")]),s._v(" "),a("h2",{attrs:{id:"_2、redis-集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、redis-集群"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_2%E3%80%81redis%E9%9B%86%E7%BE%A4"}},[s._v("#")]),s._v(" 2、Redis 集群")]),s._v(" "),a("h3",{attrs:{id:"_1、什么是集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、什么是集群"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E9%9B%86%E7%BE%A4"}},[s._v("#")]),s._v(" 1、什么是集群")]),s._v(" "),a("ul",[a("li",[s._v("Redis 集群实现了对 Redis 的水平扩容，即启动 N 个 redis 节点，将整个数据库分布存储在这 N 个节点中，每个节点存储总数据的 1/N。")]),s._v(" "),a("li",[s._v("Redis 集群通过分区（partition）来提供一定程度的可用性（availability）： 即使集群中有一部分节点失效或者无法进行通讯， 集群也可以继续处理命令请求。")])]),s._v(" "),a("h3",{attrs:{id:"_2、删除持久化数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、删除持久化数据"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_2%E3%80%81%E5%88%A0%E9%99%A4%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE"}},[s._v("#")]),s._v(" 2、删除持久化数据")]),s._v(" "),a("ul",[a("li",[s._v("将 rdb,aof 文件都删除掉。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/fb814aef06be4f5a92a810a348e8c258.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"_3、制作-6-个实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、制作-6-个实例"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_3%E3%80%81%E5%88%B6%E4%BD%9C6%E4%B8%AA%E5%AE%9E%E4%BE%8B"}},[s._v("#")]),s._v(" 3、制作 6 个实例")]),s._v(" "),a("ul",[a("li",[s._v("配置基本信息")]),s._v(" "),a("li",[s._v("开启 daemonize yes")]),s._v(" "),a("li",[s._v("Pid 文件名字")]),s._v(" "),a("li",[s._v("指定端口")]),s._v(" "),a("li",[s._v("Log 文件名字")]),s._v(" "),a("li",[s._v("Dump.rdb 名字")]),s._v(" "),a("li",[s._v("Appendonly 关掉或者换名字")])]),s._v(" "),a("h3",{attrs:{id:"_4、redis-cluster-配置修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、redis-cluster-配置修改"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_4%E3%80%81redis-cluster%E9%85%8D%E7%BD%AE%E4%BF%AE%E6%94%B9"}},[s._v("#")]),s._v(" 4、redis cluster 配置修改")]),s._v(" "),a("ul",[a("li",[s._v("cluster-enabled yes 打开集群模式")]),s._v(" "),a("li",[s._v("cluster-config-file nodes-6379.conf 设定节点配置文件名")]),s._v(" "),a("li",[s._v("cluster-node-timeout 15000 设定节点失联时间，超过该时间（毫秒），集群自动进行主从切换。")]),s._v(" "),a("li",[s._v("mkdir -p /myredis/redis_cluster")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他实例仿照就行")]),s._v("\ninclude /myredis/redis.conf\nport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\npidfile "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/run/redis_6379.pid"')]),s._v("\ndbfilename "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dump6379.rdb"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/myredis/redis_cluster"')]),s._v("\nlogfile "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/myredis/redis_cluster/redis_err_6379.log"')]),s._v("\ncluster-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-config-file nodes-6379.conf\ncluster-node-timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("1\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/196fa438ae814806bea0daef43a768d2.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"_5、启动-6-个-redis-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、启动-6-个-redis-服务"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_5%E3%80%81%E5%90%AF%E5%8A%A86%E4%B8%AAredis%E6%9C%8D%E5%8A%A1"}},[s._v("#")]),s._v(" 5、启动 6 个 redis 服务")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("redis-server /myredis/redis6379.conf\nredis-server /myredis/redis6380.conf\nredis-server /myredis/redis6381.conf\nredis-server /myredis/redis6389.conf\nredis-server /myredis/redis6390.conf\nredis-server /myredis/redis6391.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/8f18dfadd7fc4ffcbfc784ab4e2b9666.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeGlhb3h1ZUB4dWUuY29t,size_20,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"_6、将六个节点合成一个集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、将六个节点合成一个集群"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_6%E3%80%81%E5%B0%86%E5%85%AD%E4%B8%AA%E8%8A%82%E7%82%B9%E5%90%88%E6%88%90%E4%B8%80%E4%B8%AA%E9%9B%86%E7%BE%A4"}},[s._v("#")]),s._v(" 6、将六个节点合成一个集群")]),s._v(" "),a("ul",[a("li",[s._v("组合之前，请确保所有 redis 实例启动后，nodes-xxxx.conf 文件都生成正常。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/033ad3b76a8246d6a7b6e69757d153a1.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h4",{attrs:{id:"_1、合体"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、合体"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_1%E3%80%81%E5%90%88%E4%BD%93"}},[s._v("#")]),s._v(" 1、合体")]),s._v(" "),a("ul",[a("li",[s._v("此处不要用 127.0.0.1， 请用真实 IP 地址")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" create --cluster-replicas "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42.193")]),s._v(".37.228:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42.193")]),s._v(".37.228:6380 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42.193")]),s._v(".37.228:6381 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42.193")]),s._v(".37.228:6389 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42.193")]),s._v(".37.228:6390 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42.193")]),s._v(".37.228:6391\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("--replicas 1 采用最简单的方式配置集群，一台主机，一台从机，正好三组。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/3b6197b6bc134edfae4c6111d63ca83a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeGlhb3h1ZUB4dWUuY29t,size_12,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/8517ce5fca4b4f6cb6a0c715502c06b4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeGlhb3h1ZUB4dWUuY29t,size_10,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("ul",[a("li",[s._v("普通方式登录")]),s._v(" "),a("li",[s._v("可能直接进入读主机，存储数据时，会出现 MOVED 重定向操作。所以，应该以集群方式登录。 -"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/e40e5738fc9d4abd8943e468f1fba40c.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("li",[a("strong",[s._v("-c")]),s._v(" 采用集群策略连接，设置数据会自动切换到相应的写主机")]),s._v(" "),a("li",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/96475cf259f04b47a643cc73df97d627.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("li",[s._v("通过 cluster nodes 命令查看集群信息")]),s._v(" "),a("li",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/f947dcab071e4e75acf5b5e1d93043b3.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("li",[s._v("redis cluster 如何分配这六个节点?")]),s._v(" "),a("li",[s._v("一个集群至少要有三个主节点。")]),s._v(" "),a("li",[s._v("选项 --cluster-replicas 1 表示我们希望为集群中的每个主节点创建一个从节点。")]),s._v(" "),a("li",[s._v("分配原则尽量保证每个主数据库运行在不同的 IP 地址，每个从库和主库不在一个 IP 地址上。")])]),s._v(" "),a("h3",{attrs:{id:"_7、什么是-slots"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、什么是-slots"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_7%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFslots"}},[s._v("#")]),s._v(" 7、什么是 slots")]),s._v(" "),a("ul",[a("li",[s._v("一个 Redis 集群包含 16384 个插槽（hash slot）， 数据库中的每个键都属于这 16384 个插槽的其中一个")]),s._v(" "),a("li",[s._v("集群使用公式 CRC16(key) % 16384 来计算键 key 属于哪个槽， 其中 CRC16(key) 语句用于计算键 key 的 CRC16 校验和 。")]),s._v(" "),a("li",[s._v("集群中的每个节点负责处理一部分插槽。 举个例子， 如果一个集群可以有主节点， 其中：\n"),a("ul",[a("li",[s._v("节点 A 负责处理 0 号至 5460 号插槽。")]),s._v(" "),a("li",[s._v("节点 B 负责处理 5461 号至 10922 号插槽。")]),s._v(" "),a("li",[s._v("节点 C 负责处理 10923 号至 16383 号插槽。")])])])]),s._v(" "),a("h3",{attrs:{id:"_8、-查询集群中的值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、-查询集群中的值"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_8%E3%80%81-%E6%9F%A5%E8%AF%A2%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E5%80%BC"}},[s._v("#")]),s._v(" 8、 查询集群中的值")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("CLUSTER GETKEYSINSLOT "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("slot"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 返回 count 个 slot 槽中的键。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/16a14de5639b4e47ad5261a33256ebc5.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"_9、故障恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9、故障恢复"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_9%E3%80%81%E6%95%85%E9%9A%9C%E6%81%A2%E5%A4%8D"}},[s._v("#")]),s._v(" 9、故障恢复")]),s._v(" "),a("ul",[a("li",[s._v("如果主节点下线？从节点能否自动升为主节点？注意："),a("strong",[s._v("15")]),s._v("秒超时")]),s._v(" "),a("li",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/c166da03dfe24b268bd035f0c2dc483c.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("li",[s._v("主节点恢复后，主从关系会如何？主节点回来变成从机。")]),s._v(" "),a("li",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/3ea1aa8d0e0442e99c14d0f803e61f63.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("li",[s._v("如果所有某一段插槽的主从节点都宕掉，redis 服务是否还能继续?")]),s._v(" "),a("li",[s._v("如果某一段插槽的主从都挂掉，而 cluster-require-full-coverage 为 yes ，那么 ，整个集群都挂掉")]),s._v(" "),a("li",[s._v("如果某一段插槽的主从都挂掉，而 cluster-require-full-coverage 为 no ，那么，该插槽数据全都不能使用，也无法存储。")]),s._v(" "),a("li",[s._v("redis.conf 中的参数 cluster-require-full-coverage")])])])}),[],!1,null,null,null);a.default=r.exports}}]);