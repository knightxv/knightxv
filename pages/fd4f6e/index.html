<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网络和存储原理 | knightxv blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="Golang技术博客,专注Golang后端学习与总结。Linux,k8s,Docker,Golang,Mysql,Redis,Kafka,RabbitMQ等技术文章。">
    <meta name="keywords" content="Golang博客,个人技术博客,后端开发,Golang开发,技术文档,学习,面试,Docker,k8s,linux,ngnix,mysql,redis,kafka,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.3a53b6cc.css" as="style"><link rel="preload" href="/assets/js/app.478b25db.js" as="script"><link rel="preload" href="/assets/js/2.19704705.js" as="script"><link rel="preload" href="/assets/js/64.bbbca609.js" as="script"><link rel="prefetch" href="/assets/js/10.95f91cea.js"><link rel="prefetch" href="/assets/js/100.275b7847.js"><link rel="prefetch" href="/assets/js/101.c74ca928.js"><link rel="prefetch" href="/assets/js/102.bf4710d3.js"><link rel="prefetch" href="/assets/js/103.1f275ceb.js"><link rel="prefetch" href="/assets/js/104.5d3bfb0b.js"><link rel="prefetch" href="/assets/js/105.b295852e.js"><link rel="prefetch" href="/assets/js/106.fb857e8a.js"><link rel="prefetch" href="/assets/js/107.8204ca03.js"><link rel="prefetch" href="/assets/js/108.299b2f7d.js"><link rel="prefetch" href="/assets/js/109.79fe0e5e.js"><link rel="prefetch" href="/assets/js/11.8700de7c.js"><link rel="prefetch" href="/assets/js/110.b3b9b80f.js"><link rel="prefetch" href="/assets/js/111.e6f09598.js"><link rel="prefetch" href="/assets/js/112.67ccc81a.js"><link rel="prefetch" href="/assets/js/113.ff740876.js"><link rel="prefetch" href="/assets/js/114.176a36fd.js"><link rel="prefetch" href="/assets/js/115.147daf00.js"><link rel="prefetch" href="/assets/js/116.2d548bde.js"><link rel="prefetch" href="/assets/js/117.cbd16fdf.js"><link rel="prefetch" href="/assets/js/118.b7cf15c7.js"><link rel="prefetch" href="/assets/js/119.d4b36cc0.js"><link rel="prefetch" href="/assets/js/12.e3f58ac8.js"><link rel="prefetch" href="/assets/js/120.d86f62c1.js"><link rel="prefetch" href="/assets/js/121.b4a1effa.js"><link rel="prefetch" href="/assets/js/122.cc465537.js"><link rel="prefetch" href="/assets/js/123.d4390c5d.js"><link rel="prefetch" href="/assets/js/124.d539b95b.js"><link rel="prefetch" href="/assets/js/125.79940f23.js"><link rel="prefetch" href="/assets/js/126.374ea73d.js"><link rel="prefetch" href="/assets/js/127.54966bff.js"><link rel="prefetch" href="/assets/js/128.5121b6fb.js"><link rel="prefetch" href="/assets/js/129.b8e0a5d0.js"><link rel="prefetch" href="/assets/js/13.c66ba67f.js"><link rel="prefetch" href="/assets/js/130.a0accef8.js"><link rel="prefetch" href="/assets/js/131.3c16aa1e.js"><link rel="prefetch" href="/assets/js/132.d07fa9ce.js"><link rel="prefetch" href="/assets/js/133.7db5f09f.js"><link rel="prefetch" href="/assets/js/134.2131f480.js"><link rel="prefetch" href="/assets/js/135.5261a6f8.js"><link rel="prefetch" href="/assets/js/136.b6d50248.js"><link rel="prefetch" href="/assets/js/137.acb0ec2a.js"><link rel="prefetch" href="/assets/js/138.7cfd1fa4.js"><link rel="prefetch" href="/assets/js/139.06c52e45.js"><link rel="prefetch" href="/assets/js/14.c442cc83.js"><link rel="prefetch" href="/assets/js/140.aa9a9427.js"><link rel="prefetch" href="/assets/js/141.8363ae9d.js"><link rel="prefetch" href="/assets/js/142.f7f78483.js"><link rel="prefetch" href="/assets/js/143.a9efd44e.js"><link rel="prefetch" href="/assets/js/144.8be858f4.js"><link rel="prefetch" href="/assets/js/145.1d29558f.js"><link rel="prefetch" href="/assets/js/146.5e2b5784.js"><link rel="prefetch" href="/assets/js/147.0cca0aec.js"><link rel="prefetch" href="/assets/js/148.882dca2f.js"><link rel="prefetch" href="/assets/js/149.89227a60.js"><link rel="prefetch" href="/assets/js/15.32698dec.js"><link rel="prefetch" href="/assets/js/150.7983df01.js"><link rel="prefetch" href="/assets/js/151.a14333ef.js"><link rel="prefetch" href="/assets/js/152.2928a292.js"><link rel="prefetch" href="/assets/js/153.d5819247.js"><link rel="prefetch" href="/assets/js/154.c37bd12d.js"><link rel="prefetch" href="/assets/js/155.f2af6a03.js"><link rel="prefetch" href="/assets/js/156.9e871a87.js"><link rel="prefetch" href="/assets/js/157.b625ac2b.js"><link rel="prefetch" href="/assets/js/158.6686cc48.js"><link rel="prefetch" href="/assets/js/159.2a8c2e1f.js"><link rel="prefetch" href="/assets/js/16.48304ca5.js"><link rel="prefetch" href="/assets/js/160.ae097884.js"><link rel="prefetch" href="/assets/js/161.6baa833a.js"><link rel="prefetch" href="/assets/js/162.39bde05b.js"><link rel="prefetch" href="/assets/js/163.ade24e38.js"><link rel="prefetch" href="/assets/js/164.92aefe47.js"><link rel="prefetch" href="/assets/js/165.b42331c2.js"><link rel="prefetch" href="/assets/js/166.ddded921.js"><link rel="prefetch" href="/assets/js/167.fb69c9e2.js"><link rel="prefetch" href="/assets/js/168.1f650a40.js"><link rel="prefetch" href="/assets/js/169.b7524281.js"><link rel="prefetch" href="/assets/js/17.43df79e9.js"><link rel="prefetch" href="/assets/js/170.0a9b4caf.js"><link rel="prefetch" href="/assets/js/171.865ddc12.js"><link rel="prefetch" href="/assets/js/172.1e01072c.js"><link rel="prefetch" href="/assets/js/173.dc6e6a51.js"><link rel="prefetch" href="/assets/js/174.44deb739.js"><link rel="prefetch" href="/assets/js/175.ffa40359.js"><link rel="prefetch" href="/assets/js/176.d3073f53.js"><link rel="prefetch" href="/assets/js/177.804e18b1.js"><link rel="prefetch" href="/assets/js/178.1a16ec29.js"><link rel="prefetch" href="/assets/js/179.f0d2fb43.js"><link rel="prefetch" href="/assets/js/18.8fb729ff.js"><link rel="prefetch" href="/assets/js/180.dd6e429c.js"><link rel="prefetch" href="/assets/js/181.a31fd28f.js"><link rel="prefetch" href="/assets/js/182.d8e77001.js"><link rel="prefetch" href="/assets/js/183.eb9b3c4d.js"><link rel="prefetch" href="/assets/js/184.ba358ccf.js"><link rel="prefetch" href="/assets/js/19.640532f4.js"><link rel="prefetch" href="/assets/js/20.83809704.js"><link rel="prefetch" href="/assets/js/21.050e2205.js"><link rel="prefetch" href="/assets/js/22.0f134e70.js"><link rel="prefetch" href="/assets/js/23.4c4b4170.js"><link rel="prefetch" href="/assets/js/24.360a91e0.js"><link rel="prefetch" href="/assets/js/25.8e2a6516.js"><link rel="prefetch" href="/assets/js/26.0d7c551b.js"><link rel="prefetch" href="/assets/js/27.a70124a9.js"><link rel="prefetch" href="/assets/js/28.3e9f695e.js"><link rel="prefetch" href="/assets/js/29.3c8a27ba.js"><link rel="prefetch" href="/assets/js/3.eeb249ae.js"><link rel="prefetch" href="/assets/js/30.a00cdb1d.js"><link rel="prefetch" href="/assets/js/31.b9ac1ef2.js"><link rel="prefetch" href="/assets/js/32.89a83c23.js"><link rel="prefetch" href="/assets/js/33.6abb0fbc.js"><link rel="prefetch" href="/assets/js/34.eca914fd.js"><link rel="prefetch" href="/assets/js/35.6d912e24.js"><link rel="prefetch" href="/assets/js/36.2a25d869.js"><link rel="prefetch" href="/assets/js/37.50623c01.js"><link rel="prefetch" href="/assets/js/38.d28f2863.js"><link rel="prefetch" href="/assets/js/39.d738068c.js"><link rel="prefetch" href="/assets/js/4.be154c6d.js"><link rel="prefetch" href="/assets/js/40.ce93760c.js"><link rel="prefetch" href="/assets/js/41.b68e64a6.js"><link rel="prefetch" href="/assets/js/42.d4e5b931.js"><link rel="prefetch" href="/assets/js/43.a48f8215.js"><link rel="prefetch" href="/assets/js/44.018c165a.js"><link rel="prefetch" href="/assets/js/45.02bc0a06.js"><link rel="prefetch" href="/assets/js/46.6fe5e60d.js"><link rel="prefetch" href="/assets/js/47.9a58c13c.js"><link rel="prefetch" href="/assets/js/48.6d1d583d.js"><link rel="prefetch" href="/assets/js/49.a9c3e37e.js"><link rel="prefetch" href="/assets/js/5.2e93bd71.js"><link rel="prefetch" href="/assets/js/50.2dc03bb2.js"><link rel="prefetch" href="/assets/js/51.4bda7fd3.js"><link rel="prefetch" href="/assets/js/52.c136add0.js"><link rel="prefetch" href="/assets/js/53.761906d2.js"><link rel="prefetch" href="/assets/js/54.f5d16e1c.js"><link rel="prefetch" href="/assets/js/55.5ace088a.js"><link rel="prefetch" href="/assets/js/56.d3377025.js"><link rel="prefetch" href="/assets/js/57.f37089e0.js"><link rel="prefetch" href="/assets/js/58.4f2b8aca.js"><link rel="prefetch" href="/assets/js/59.39586d5f.js"><link rel="prefetch" href="/assets/js/6.5a6a1be3.js"><link rel="prefetch" href="/assets/js/60.505a7059.js"><link rel="prefetch" href="/assets/js/61.b3cea5b9.js"><link rel="prefetch" href="/assets/js/62.e3765f3c.js"><link rel="prefetch" href="/assets/js/63.2ceeb34a.js"><link rel="prefetch" href="/assets/js/65.2a1a4764.js"><link rel="prefetch" href="/assets/js/66.5d00d34d.js"><link rel="prefetch" href="/assets/js/67.22172417.js"><link rel="prefetch" href="/assets/js/68.00506c8c.js"><link rel="prefetch" href="/assets/js/69.1e27e57b.js"><link rel="prefetch" href="/assets/js/7.b7a6731a.js"><link rel="prefetch" href="/assets/js/70.99093f55.js"><link rel="prefetch" href="/assets/js/71.e62e650a.js"><link rel="prefetch" href="/assets/js/72.9050c63d.js"><link rel="prefetch" href="/assets/js/73.741d3cb5.js"><link rel="prefetch" href="/assets/js/74.411b114e.js"><link rel="prefetch" href="/assets/js/75.84f6f42b.js"><link rel="prefetch" href="/assets/js/76.d7780c55.js"><link rel="prefetch" href="/assets/js/77.b8912163.js"><link rel="prefetch" href="/assets/js/78.d6c2885a.js"><link rel="prefetch" href="/assets/js/79.937a1510.js"><link rel="prefetch" href="/assets/js/8.6ea75b66.js"><link rel="prefetch" href="/assets/js/80.32ac7886.js"><link rel="prefetch" href="/assets/js/81.8cfb1d7e.js"><link rel="prefetch" href="/assets/js/82.ef4b20c5.js"><link rel="prefetch" href="/assets/js/83.488c5d82.js"><link rel="prefetch" href="/assets/js/84.e4d962fe.js"><link rel="prefetch" href="/assets/js/85.19229f5c.js"><link rel="prefetch" href="/assets/js/86.bd23e8fe.js"><link rel="prefetch" href="/assets/js/87.d138f840.js"><link rel="prefetch" href="/assets/js/88.050882c5.js"><link rel="prefetch" href="/assets/js/89.87dd68af.js"><link rel="prefetch" href="/assets/js/9.0154c226.js"><link rel="prefetch" href="/assets/js/90.90969884.js"><link rel="prefetch" href="/assets/js/91.8aff861d.js"><link rel="prefetch" href="/assets/js/92.739e9127.js"><link rel="prefetch" href="/assets/js/93.300d29e5.js"><link rel="prefetch" href="/assets/js/94.a4799b7e.js"><link rel="prefetch" href="/assets/js/95.088c14bc.js"><link rel="prefetch" href="/assets/js/96.2845dd25.js"><link rel="prefetch" href="/assets/js/97.7a21d89c.js"><link rel="prefetch" href="/assets/js/98.76d03daa.js"><link rel="prefetch" href="/assets/js/99.d763ed95.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3a53b6cc.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="knightxv blog" class="logo"> <span class="site-name can-hide">knightxv blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Golang" class="dropdown-title"><a href="/golang/" class="link-title">Golang</a> <span class="title" style="display:none;">Golang</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Golang学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/concurrency/" class="nav-link">Golang并发编程</a></li><li class="dropdown-subitem"><a href="/note/goweb/" class="nav-link">Go Web编程</a></li><li class="dropdown-subitem"><a href="/note/design/" class="nav-link">GO设计模式</a></li></ul></li><li class="dropdown-item"><h4>Golang源码分析</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2a2a29/" class="nav-link">Map数据结构</a></li><li class="dropdown-subitem"><a href="/pages/033145/" class="nav-link">Slice数据结构</a></li><li class="dropdown-subitem"><a href="/pages/fa897f/" class="nav-link">Mutex锁实现</a></li><li class="dropdown-subitem"><a href="/pages/6fd99d/" class="nav-link">Select多路复用</a></li><li class="dropdown-subitem"><a href="/pages/ef333e/" class="nav-link">channel数据结构</a></li><li class="dropdown-subitem"><a href="/pages/6f723b/" class="nav-link">GC垃圾回收</a></li><li class="dropdown-subitem"><a href="/pages/a9fc54/" class="nav-link">抢占式调度</a></li><li class="dropdown-subitem"><a href="/pages/ea484b/" class="nav-link">栈内存管理</a></li><li class="dropdown-subitem"><a href="/pages/5c796e/" class="nav-link">堆内存管理</a></li><li class="dropdown-subitem"><a href="/pages/e50bab/" class="nav-link">syncMap</a></li><li class="dropdown-subitem"><a href="/pages/650967/" class="nav-link">RWMutex</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/middleware/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/188a39/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/c7c832/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/835ebb/" class="nav-link">Kafka</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><a href="/pages/1b3fc1/" class="link-title">分布式</a> <span class="title" style="display:none;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/1b3fc1/" class="nav-link">分布式系统简介</a></li><li class="dropdown-item"><!----> <a href="/pages/a2771c/" class="nav-link">分布式锁</a></li><li class="dropdown-item"><!----> <a href="/pages/bc9e47/" class="nav-link">分布式事务</a></li><li class="dropdown-item"><!----> <a href="/pages/dc26b3/" class="nav-link">共识算法</a></li><li class="dropdown-item"><!----> <a href="/pages/04f3b6/" class="nav-link">分布式方案</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><a href="/cloud/" class="link-title">云原生</a> <span class="title" style="display:none;">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>云原生</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/76e4ce/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/pages/659fe3/" class="nav-link">K8s</a></li></ul></li><li class="dropdown-item"><h4>计算机编程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3c1fcd/" class="nav-link">网络编程</a></li><li class="dropdown-subitem"><a href="/pages/f3939b/" class="nav-link">系统编程</a></li></ul></li><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b88ef2/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/pages/116a48/" class="nav-link">Shell</a></li></ul></li><li class="dropdown-item"><h4>Ngnix</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/d57825/" class="nav-link">Ngnix</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目案例分享" class="dropdown-title"><a href="/project/" class="link-title">项目案例分享</a> <span class="title" style="display:none;">项目案例分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8c4a48/" class="nav-link">IM系统</a></li><li class="dropdown-item"><!----> <a href="/pages/d856af/" class="nav-link">数字商品抢购系统</a></li><li class="dropdown-item"><!----> <a href="/pages/c7d922/" class="nav-link">缓存一致性实践</a></li><li class="dropdown-item"><!----> <a href="/pages/1a65ee/" class="nav-link">数据库分库分表</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂谈</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li></ul></div></div> <a href="https://github.com/knightxv" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/21257387.37qtdt8nb6q0.5nrhimpl5i00.webp"> <div class="blogger-info"><h3>knightxv</h3> <span>立志成为架构师的一名普通gopher~</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Golang" class="dropdown-title"><a href="/golang/" class="link-title">Golang</a> <span class="title" style="display:none;">Golang</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Golang学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/concurrency/" class="nav-link">Golang并发编程</a></li><li class="dropdown-subitem"><a href="/note/goweb/" class="nav-link">Go Web编程</a></li><li class="dropdown-subitem"><a href="/note/design/" class="nav-link">GO设计模式</a></li></ul></li><li class="dropdown-item"><h4>Golang源码分析</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2a2a29/" class="nav-link">Map数据结构</a></li><li class="dropdown-subitem"><a href="/pages/033145/" class="nav-link">Slice数据结构</a></li><li class="dropdown-subitem"><a href="/pages/fa897f/" class="nav-link">Mutex锁实现</a></li><li class="dropdown-subitem"><a href="/pages/6fd99d/" class="nav-link">Select多路复用</a></li><li class="dropdown-subitem"><a href="/pages/ef333e/" class="nav-link">channel数据结构</a></li><li class="dropdown-subitem"><a href="/pages/6f723b/" class="nav-link">GC垃圾回收</a></li><li class="dropdown-subitem"><a href="/pages/a9fc54/" class="nav-link">抢占式调度</a></li><li class="dropdown-subitem"><a href="/pages/ea484b/" class="nav-link">栈内存管理</a></li><li class="dropdown-subitem"><a href="/pages/5c796e/" class="nav-link">堆内存管理</a></li><li class="dropdown-subitem"><a href="/pages/e50bab/" class="nav-link">syncMap</a></li><li class="dropdown-subitem"><a href="/pages/650967/" class="nav-link">RWMutex</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/middleware/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/188a39/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/c7c832/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/835ebb/" class="nav-link">Kafka</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><a href="/pages/1b3fc1/" class="link-title">分布式</a> <span class="title" style="display:none;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/1b3fc1/" class="nav-link">分布式系统简介</a></li><li class="dropdown-item"><!----> <a href="/pages/a2771c/" class="nav-link">分布式锁</a></li><li class="dropdown-item"><!----> <a href="/pages/bc9e47/" class="nav-link">分布式事务</a></li><li class="dropdown-item"><!----> <a href="/pages/dc26b3/" class="nav-link">共识算法</a></li><li class="dropdown-item"><!----> <a href="/pages/04f3b6/" class="nav-link">分布式方案</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><a href="/cloud/" class="link-title">云原生</a> <span class="title" style="display:none;">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>云原生</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/76e4ce/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/pages/659fe3/" class="nav-link">K8s</a></li></ul></li><li class="dropdown-item"><h4>计算机编程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3c1fcd/" class="nav-link">网络编程</a></li><li class="dropdown-subitem"><a href="/pages/f3939b/" class="nav-link">系统编程</a></li></ul></li><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b88ef2/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/pages/116a48/" class="nav-link">Shell</a></li></ul></li><li class="dropdown-item"><h4>Ngnix</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/d57825/" class="nav-link">Ngnix</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目案例分享" class="dropdown-title"><a href="/project/" class="link-title">项目案例分享</a> <span class="title" style="display:none;">项目案例分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8c4a48/" class="nav-link">IM系统</a></li><li class="dropdown-item"><!----> <a href="/pages/d856af/" class="nav-link">数字商品抢购系统</a></li><li class="dropdown-item"><!----> <a href="/pages/c7d922/" class="nav-link">缓存一致性实践</a></li><li class="dropdown-item"><!----> <a href="/pages/1a65ee/" class="nav-link">数据库分库分表</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂谈</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li></ul></div></div> <a href="https://github.com/knightxv" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>云原生</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Docker</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>docker基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/76e4ce/" class="sidebar-link">Docker基础概念</a></li><li><a href="/pages/234a90/" class="sidebar-link">镜像容器</a></li><li><a href="/pages/37754f/" class="sidebar-link">Docker安装基本应用</a></li><li><a href="/pages/fd4f6e/" aria-current="page" class="active sidebar-link">网络和存储原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/fd4f6e/#四、网络和存储原理" class="sidebar-link">[#](#四、网络和存储原理) 四、网络和存储原理</a></li><li class="sidebar-sub-header level2"><a href="/pages/fd4f6e/#_1、docker-存储" class="sidebar-link">[#](#_1、docker存储) 1、Docker 存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/fd4f6e/#_1、镜像如何存储" class="sidebar-link">[#](#_1、镜像如何存储) 1、镜像如何存储</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_1、images-and-layers" class="sidebar-link">[#](#_1、images-and-layers) 1、Images and layers</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_2、container-and-layers" class="sidebar-link">[#](#_2、container-and-layers) 2、Container and layers</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_3、磁盘容量预估" class="sidebar-link">[#](#_3、磁盘容量预估) 3、磁盘容量预估</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_4、镜像如何挑选" class="sidebar-link">[#](#_4、镜像如何挑选) 4、镜像如何挑选</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_5、copy-on-write" class="sidebar-link">[#](#_5、copy-on-write) 5、Copy On Write</a></li><li class="sidebar-sub-header level3"><a href="/pages/fd4f6e/#_2、容器如何挂载" class="sidebar-link">[#](#_2、容器如何挂载) 2、容器如何挂载</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_1、volume-卷" class="sidebar-link">[#](#_1、volume-卷) 1、volume(卷)</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_2、bind-mount" class="sidebar-link">[#](#_2、bind-mount) 2、bind mount</a></li><li class="sidebar-sub-header level3"><a href="/pages/fd4f6e/#_3、管理卷" class="sidebar-link">[#](#_3、管理卷) 3、管理卷</a></li><li class="sidebar-sub-header level3"><a href="/pages/fd4f6e/#_4、docker-cp" class="sidebar-link">[#](#_4、docker-cp) 4、docker cp</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/fd4f6e/#_2、docker-网络" class="sidebar-link">[#](#_2、docker网络) 2、Docker 网络</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/fd4f6e/#_1、docker-启动后-网络情况" class="sidebar-link">[#](#_1、docker启动后-网络情况) 1、Docker 启动后，网络情况</a></li><li class="sidebar-sub-header level3"><a href="/pages/fd4f6e/#_2、常用命令" class="sidebar-link">[#](#_2、常用命令) 2、常用命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/fd4f6e/#_3、网络模式" class="sidebar-link">[#](#_3、网络模式) 3、网络模式</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_1、bridge" class="sidebar-link">[#](#_1、bridge) 1、bridge</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_2、host" class="sidebar-link">[#](#_2、host) 2、host</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_3、none" class="sidebar-link">[#](#_3、none) 3、none</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_4、container" class="sidebar-link">[#](#_4、container) 4、container</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_5、自定义网络" class="sidebar-link">[#](#_5、自定义网络) 5、自定义网络</a></li><li class="sidebar-sub-header level3"><a href="/pages/fd4f6e/#_4、端口映射" class="sidebar-link">[#](#_4、端口映射) 4、端口映射</a></li><li class="sidebar-sub-header level3"><a href="/pages/fd4f6e/#_5、容器互联" class="sidebar-link">[#](#_5、容器互联) 5、容器互联</a></li><li class="sidebar-sub-header level3"><a href="/pages/fd4f6e/#_6、自定义网络-原理" class="sidebar-link">[#](#_6、自定义网络-原理) 6、自定义网络（原理）</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_1、默认网络原理" class="sidebar-link">[#](#_1、默认网络原理) 1、默认网络原理</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_2、网络模式" class="sidebar-link">[#](#_2、网络模式) 2、网络模式</a></li><li class="sidebar-sub-header level4"><a href="/pages/fd4f6e/#_3、自建网络测试" class="sidebar-link">[#](#_3、自建网络测试) 3、自建网络测试</a></li><li class="sidebar-sub-header level3"><a href="/pages/fd4f6e/#_7、docker-平台架构" class="sidebar-link">[#](#_7、docker平台架构) 7、Docker 平台架构</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>Docker进阶</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>K8s</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Shell编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ngnix</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E4%BA%91%E5%8E%9F%E7%94%9F" title="分类" data-v-06225672>云原生</a></li><li data-v-06225672><a href="/categories/?category=%E4%BA%91%E5%8E%9F%E7%94%9F" title="分类" data-v-06225672>云原生</a></li><li data-v-06225672><a href="/categories/?category=Docker" title="分类" data-v-06225672>Docker</a></li><li data-v-06225672><a href="/categories/?category=docker%E5%9F%BA%E7%A1%80" title="分类" data-v-06225672>docker基础</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/knightxv" target="_blank" title="作者" class="beLink" data-v-06225672>knightxv</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-08-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">网络和存储原理<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="四、网络和存储原理"><a href="#四、网络和存储原理" class="header-anchor">#</a> <a href="#%E5%9B%9B%E3%80%81%E7%BD%91%E7%BB%9C%E5%92%8C%E5%AD%98%E5%82%A8%E5%8E%9F%E7%90%86">#</a> 四、网络和存储原理</h2> <p>问题：</p> <ul><li>容器： 某个软件完整的运行环境；包含了一个小型的 linux 系统</li> <li>宿主机里面同时 4 个 nginx； 一个 nginx 运行时完整环境有 20MB？</li> <li><ul><li>4 个 nginx 合起来占用多少的磁盘空间</li> <li>80？如果每一个容器启动都是一个完整的 linux 系统一定会很大....</li></ul></li></ul> <p>docker 装的和宿主机的优缺点：</p> <p>优点：docker 的移植性、便捷性高于在宿主机部署、进程隔离、很方便的资源限制</p> <p>缺点：docker 基于虚拟化技术，损失不到 3%的性能。</p> <p><strong>镜像 容器</strong></p> <p><code>镜像</code>（Image）：固定不变的。一个镜像可以启动很多容器</p> <p><code>容器</code>（Container）：文件系统可能 logs 经常变化的，一个镜像可以启动很多容器。</p> <p>docker 在底层使用自己的存储驱动。来组件文件内容 storage drivers。</p> <h2 id="_1、docker-存储"><a href="#_1、docker-存储" class="header-anchor">#</a> <a href="#_1%E3%80%81docker%E5%AD%98%E5%82%A8">#</a> 1、Docker 存储</h2> <h3 id="_1、镜像如何存储"><a href="#_1、镜像如何存储" class="header-anchor">#</a> <a href="#_1%E3%80%81%E9%95%9C%E5%83%8F%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8">#</a> 1、镜像如何存储</h3> <p>截取的 nginx 的分层</p> <p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-1.57zflwehs9c.webp" alt="image-20210628114842703"></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>nginx这个镜像怎么存的
使用：docker image inspect nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-2.34loio12wl40.webp" alt="image-20210628114916784"></p> <blockquote><p>指示了镜像怎么存的</p> <p>LowerDir ：底层目录; diff（只是存储不同）；包含小型 linux 和装好的软件</p></blockquote> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>/var/lib/docker/overlay2/67b3802c6bdb5bcdbcccbbe7aed20faa7227d584ab37668a03ff6952e631f7f2/diff：用户文件；

/var/lib/docker/overlay2/f56920fac9c356227079df41c8f4b056118c210bf4c50bd9bb077bdb4c7524b4/diff： nginx的启动命令放在这里

/var/lib/docker/overlay2/0e569a134838b8c2040339c4fdb1f3868a7118dd7f4907b40468f5fe60f055e5/diff： nginx的配置文件在这里

/var/lib/docker/overlay2/2b51c82933078e19d78b74c248dec38164b90d80c1b42f0fdb1424953207166e/diff: 小linux系统
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>倒着看</li> <li><ul><li>小 linux 系统（FROM apline） + Dockerfile 的每一个命令可能都引起了系统的修改，所以和 git 一样，只记录变化</li></ul></li></ul> <p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-3.32no8f4dods0.webp" alt="image-20210628115008639"></p> <ul><li><ul><li>我们进入到这个镜像启动的容器，容器的文件系统就是镜像的；</li> <li>docker ps -s；可以看到这个容器真正用到的文件大小</li> <li>容器会自己建立层；如果想要改东西，把改的内容复制到容器层即可 docker inspect container</li></ul></li></ul> <div class="language-text line-numbers-mode"><pre class="language-text"><code>&quot;LowerDir&quot;:
&quot;/var/lib/docker/overlay2/41e4fa41a2ad1dca9616d4c8254a04c4d9d6a3d462
c862f1e9a0562de2384dbc-
init/diff:/var/lib/docker/overlay2/e3b8bdbb0cfbe5450696c470994b3f99e
8a7942078e2639a788027529c6278f7/diff:/var/lib/docker/overlay2/67b380
2c6bdb5bcdbcccbbe7aed20faa7227d584ab37668a03ff6952e631f7f2/diff:/var
/lib/docker/overlay2/f56920fac9c356227079df41c8f4b056118c210bf4c50bd
9bb077bdb4c7524b4/diff:/var/lib/docker/overlay2/0e569a134838b8c20403
39c4fdb1f3868a7118dd7f4907b40468f5fe60f055e5/diff:/var/lib/docker/ov
erlay2/2b51c82933078e19d78b74c248dec38164b90d80c1b42f0fdb14249532071
66e/diff&quot;,
       &quot;MergedDir&quot;:
&quot;/var/lib/docker/overlay2/41e4fa41a2ad1dca9616d4c8254a04c4d9d6a3d462
c862f1e9a0562de2384dbc/merged&quot;,
       &quot;UpperDir&quot;: （镜像的上层可以感知变
化）&quot;/var/lib/docker/overlay2/41e4fa41a2ad1dca9616d4c8254a04c4d9d6a3d
462c862f1e9a0562de2384dbc/diff&quot;,【容器的修改后的文件，保存再宿主机哪里呀。
容器删除后，那些容器目录还存在吗？一定不再】
       &quot;WorkDir&quot;:
&quot;/var/lib/docker/overlay2/41e4fa41a2ad1dca9616d4c8254a04c4d9d6a3d462
c862f1e9a0562de2384dbc/work&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ul><li>MergedDir ：合并目录；容器最终的完整工作目录全内容都在合并层；数据卷在容器层产生；所有的增删改都在容器层；</li></ul> <p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-4.28wheb2g8xwk.webp" alt="image-20210628115025473"></p> <ul><li>UpperDir ：上层目录；</li> <li>WorkDir ：工作目录（临时层），pid；</li></ul> <blockquote><p>LowerDir（底层）\UpperDir（）\MergedDir\WorkDir(临时东西)</p> <p>docker 底层的 storage driver 完成了以上的目录组织结果；</p></blockquote> <p>哪些东西适合容器运行？</p> <ul><li>docker 启动一个 MySQL，默认什么都不做？</li> <li>MySQL 就会丢失数据</li> <li><ul><li>文件挂载</li> <li>docker commit：能提交，MySQL 的容器，也能提交。100G；100G，一般不采用这种方式</li></ul></li></ul> <h4 id="_1、images-and-layers"><a href="#_1、images-and-layers" class="header-anchor">#</a> <a href="#_1%E3%80%81images-and-layers">#</a> 1、Images and layers</h4> <p>Docker 映像由一系列层组成。 每层代表图像的 Dockerfile 中的一条指令。 除最后一层外的每一层都是只读的。 如以下 Dockerfile：</p> <ul><li>Dockerfile 文件里面几句话，镜像就有几层</li></ul> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> ubuntu:15.04</span>
<span class="token instruction"><span class="token keyword">COPY</span> . /app</span>
<span class="token instruction"><span class="token keyword">RUN</span> make /app</span>
<span class="token instruction"><span class="token keyword">CMD</span> python /app/app.py</span>
<span class="token comment"># 每一个指令都可能会引起镜像改变，这些改变类似git的方式逐层叠加。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>该 Dockerfile 包含四个命令，每个命令创建一个层。</p> <p>FROM 语句从 ubuntu：15.04 映像创建一个图层开始。</p> <p>COPY 命令从 Docker 客户端的当前目录添加一些文件。</p> <p>RUN 命令使用 make 命令构建您的应用程序。</p> <p>最后，最后一层指定要在容器中运行的命令。</p> <p>每一层只是与上一层不同的一组。 这些层彼此堆叠。</p> <p>创建新容器时，可以在基础层之上添加一个新的可写层。 该层通常称为“容器层”。 对运行中</p> <p>的容器所做的所有更改（例如写入新文件，修改现有文件和删除文件）都将写入此薄可写容</p> <p>器层。</p></blockquote> <p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-5.73mutlha23o0.webp" alt="image-20210628115042492"></p> <h4 id="_2、container-and-layers"><a href="#_2、container-and-layers" class="header-anchor">#</a> <a href="#_2%E3%80%81container-and-layers">#</a> 2、Container and layers</h4> <blockquote><ul><li>容器和镜像之间的主要区别是可写顶层。</li> <li>在容器中添加新数据或修改现有数据的所有写操作都存储在此可写层中。</li> <li>删除容器后，可写层也会被删除。 基础图像保持不变。 因为每个容器都有其自己的可写容</li></ul> <p>​ 器层，并且所有更改都存储在该容器层中，所以多个容器可以共享对同一基础映像的访问，</p> <p>​ 但具有自己的数据状态。</p></blockquote> <ul><li>下图显示了共享同一 Ubuntu 15.04 映像的多个容器。</li></ul> <p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-6.5tqflhsm2co0.webp" alt="image-20210628115103792"></p> <h4 id="_3、磁盘容量预估"><a href="#_3、磁盘容量预估" class="header-anchor">#</a> <a href="#_3%E3%80%81%E7%A3%81%E7%9B%98%E5%AE%B9%E9%87%8F%E9%A2%84%E4%BC%B0">#</a> 3、磁盘容量预估</h4> <blockquote><p>docker ps -s</p> <p>size：用于每个容器的可写层的数据量（在磁盘上）。</p> <p>virtual size：容器使用的用于只读图像数据的数据量加上容器的可写图层大小。</p> <p>多个容器可以共享部分或全部只读图像数据。</p> <p>从同一图像开始的两个容器共享 100％的只读数据，而具有不同图像的两个容器（具有相同的层）共享这些公共</p> <p>层。 因此，不能只对虚拟大小进行总计。这高估了总磁盘使用量，可能是一笔不小的数目。</p></blockquote> <h4 id="_4、镜像如何挑选"><a href="#_4、镜像如何挑选" class="header-anchor">#</a> <a href="#_4%E3%80%81%E9%95%9C%E5%83%8F%E5%A6%82%E4%BD%95%E6%8C%91%E9%80%89">#</a> 4、镜像如何挑选</h4> <blockquote><p>busybox：是一个集成了一百多个最常用 Linux 命令和工具的软件。linux 工具里的瑞士军刀</p> <p>alpine：Alpine 操作系统是一个面向安全的轻型 Linux 发行版经典最小镜像，基于 busybox，功能比</p> <p>Busybox 完善。</p> <p>slim：docker hub 中有些镜像有 slim 标识，都是瘦身了的镜像。也要优先选择</p> <p>无论是制作镜像还是下载镜像，优先选择 alpine 类型.</p></blockquote> <h4 id="_5、copy-on-write"><a href="#_5、copy-on-write" class="header-anchor">#</a> <a href="#_5%E3%80%81copy-on-write">#</a> 5、Copy On Write</h4> <ul><li>写时复制是一种共享和复制文件的策略，可最大程度地提高效率。</li> <li>如果文件或目录位于映像的较低层中，而另一层（包括可写层）需要对其进行读取访问，则它仅使用现有文件。</li> <li>另一层第一次需要修改文件时（在构建映像或运行容器时），将文件复制到该层并进行修改。 这样可以将 I / O 和每个后续层的大小最小化。</li></ul> <h3 id="_2、容器如何挂载"><a href="#_2、容器如何挂载" class="header-anchor">#</a> <a href="#_2%E3%80%81%E5%AE%B9%E5%99%A8%E5%A6%82%E4%BD%95%E6%8C%82%E8%BD%BD">#</a> 2、容器如何挂载</h3> <p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-7.4rennohzgem0.webp" alt="image-"></p> <p>每一个容器里面的内容，支持三种挂载方式：</p> <p>1）、docker 自动在外部创建文件夹自动挂载容器内部指定的文件夹内容【Dockerfile VOLUME 指令的作用】</p> <p>2）、自己在外部创建文件夹，手动挂载</p> <p>3）、可以把数据挂载到内存中。</p> <p>--mount 挂载到 linux 宿主机，手动挂载（不用了）</p> <p>-v 可以自动挂载，到 linux 主机或者 docker 自动管理的这一部分区域</p> <ul><li>Volumes(卷) ：存储在主机文件系统的一部分中，该文件系统由 Docker 管理（在 Linux 上是“ / var /lib / docker / volumes /”）。 非 Docker 进程不应修改文件系统的这一部分。 卷是在 Docker 中持久存储数据的最佳方法。</li> <li>Bind mounts(绑定挂载) 可以在任何地方 存储在主机系统上。 它们甚至可能是重要的系统文件或目录。 Docker 主机或 Docker 容器上的非 Docker 进程可以随时对其进行修改。</li> <li>tmpfs mounts(临时挂载) 仅存储在主机系统的内存中，并且永远不会写入主机系统的文件系统</li></ul> <h4 id="_1、volume-卷"><a href="#_1、volume-卷" class="header-anchor">#</a> <a href="#_1%E3%80%81volume-%E5%8D%B7">#</a> 1、volume(卷)</h4> <ul><li><strong>匿名卷使用</strong></li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> run <span class="token parameter variable">-dP</span> <span class="token parameter variable">-v</span> /etc/nginx nginx
<span class="token comment"># docker将创建出匿名卷，并保存容器/etc/nginx下面的内容</span>
<span class="token comment"># -v 宿主机:容器里的目录</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><strong>具名卷使用</strong></li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> run <span class="token parameter variable">-dP</span> <span class="token parameter variable">-v</span> nginx:/etc/nginx nginx
<span class="token comment">#docker将创建出名为nginx的卷，并保存容器/etc/nginx下面的内容</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>如果将空卷装入存在文件或目录的容器中的目录中，则容器中的内容（复制）到该卷中。</p> <p>如果启动一个容器并指定一个尚不存在的卷，则会创建一个空卷。</p></blockquote> <p>-v 宿主机绝对路径:Docker 容器内部绝对路径：叫挂载；这个有空挂载问题</p> <p>-v 不以/开头的路径:Docker 容器内部绝对路径：叫绑定（docker 会自动管理，docker 不会把他当成目录，而把它当前卷）</p> <p><strong>以上用哪个比较好？？？？？？</strong></p> <ul><li>如果自己开发测试，用 -v 绝对路径的方式</li> <li>如果是生产环境建议用卷</li> <li>除非特殊 /bin/docker 需要挂载主机路径的则操作 绝对路径挂载</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>nginx--Docker
/usr/share/nginx/html

nginx测试html挂载几种不同情况：

<span class="token number">1</span>.不挂载 效果：访问默认欢迎页

<span class="token number">2</span>.挂载 <span class="token parameter variable">-v</span> /root/html:/usr/share/nginx/html
效果：访问forbidden <span class="token punctuation">(</span>空挂载<span class="token punctuation">)</span>
<span class="token function">docker</span> run <span class="token parameter variable">-dP</span> <span class="token parameter variable">-v</span> /root/html:/usr/share/nginx/html nginx

<span class="token number">3</span>.具名卷 <span class="token parameter variable">-v</span> html:/usr/share/nginx/html:ro 效果：访问默认欢迎页<span class="token punctuation">(</span>:ro 表示容器内只读<span class="token punctuation">)</span>
<span class="token function">docker</span> run <span class="token parameter variable">-dP</span> <span class="token parameter variable">-v</span> html:/usr/share/nginx/html:ro nginx

<span class="token number">4</span>.匿名卷 <span class="token parameter variable">-v</span> /usr/share/nginx/html （什么都不写也不要加冒号，直接写容器内的目录）
<span class="token function">docker</span> run <span class="token parameter variable">-dP</span> <span class="token parameter variable">-v</span> /usr/share/nginx/html nginx

原因：
<span class="token parameter variable">-v</span> html:/usr/share/nginx/html<span class="token punctuation">;</span>
<span class="token comment"># -v不以绝对路径方式；</span>
<span class="token comment">### 1、先在docker底层创建一个你指定名字的卷（具名卷） html</span>
<span class="token comment">### 2、把这个卷和容器内部目录绑定</span>
<span class="token comment">### 3、容器启动以后，目录里面的内容就在卷里面存着；</span>
<span class="token comment">##### -v nginxhtml:/usr/share/nginx/html 也可以以下操作</span>
<span class="token comment">## 1、 docker create volume nginxhtml 如果给卷里面就行修改，容器内部的也就改</span>
了。
<span class="token comment">## 2、 docker volume inspect nginxhtml</span>
<span class="token comment">## 3、docker run -d -P -v nginxhtml:/usr/share/nginx/html --</span>
<span class="token comment"># docker inspect 容器的时候可以看到</span>
<span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
     <span class="token punctuation">{</span>
        <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>, //这是个卷
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;html&quot;</span>,  //名字是html
        <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/html/_data&quot;</span>,  //宿主机的目录。容器里面的哪两个文件都在
        <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/share/nginx/html&quot;</span>,  //容器内部
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;z&quot;</span>,
        <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,  //读写模式
        <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">]</span>
<span class="token comment">#卷：就是为了保存数据</span>
<span class="token function">docker</span> volume  <span class="token comment">#可以对docker自己管理的卷目录进行操作；</span>
/var/lib/docker/volumes<span class="token punctuation">(</span>卷的根目录<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h4 id="_2、bind-mount"><a href="#_2、bind-mount" class="header-anchor">#</a> <a href="#_2%E3%80%81bind-mount">#</a> 2、bind mount</h4> <blockquote><p>如果将绑定安装或非空卷安装到存在某些文件或目录的容器中的目录中，则这些文件或目录会被</p> <p>安装遮盖，就像您将文件保存到 Linux 主机上的/ mnt 中一样，然后 将 USB 驱动器安装到/ mnt 中。</p> <p>在卸载 USB 驱动器之前，/ mnt 的内容将被 USB 驱动器的内容遮盖。 被遮盖的文件不会被删除或更</p> <p>改，但是在安装绑定安装或卷时将无法访问。</p> <p>总结：外部目录覆盖内部容器目录内容，但不是修改。所以谨慎，外部空文件夹挂载方式也会导</p> <p>致容器内部是空文件夹</p></blockquote> <div class="language-text line-numbers-mode"><pre class="language-text"><code>docker run -dP -v /my/nginx:/etc/nginx nginx

# bind mount和 volumes 的方式写法区别在于
# 所有以/开始的都认为是 bind mount ，不以/开始的都认为是 volumes.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>警惕 bind mount 方式，文件挂载没有在外部准备好内容而导致的容器启动失败问题</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 一行命令启动nginx，并且配置文件和html页面。需要知道卷的位置才能改</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">-v</span> nginxconf:/etc/nginx/ <span class="token parameter variable">-v</span> nginxpage:/usr/share/nginx/html nginx
<span class="token comment"># 想要实现 docker run -d -P -v /root/nginxconf:/etc/nginx/ -v /root/nginxhtml:/usr/share/nginx/html --name=nginx999 nginx</span>
<span class="token comment">### 1、提前准备好东西 目录nginxconf，目录里面的配置we年都放里面，，再调用命令</span>
<span class="token comment">### 2、docker cp nginxdemo:/etc/nginx /root/nginxconf #注意/的使用</span>
<span class="token comment">### 3、docker run -d -P -v /root/nginxconf:/etc/nginx/ -v /root/nginxhtml:/usr/share/nginx/html --name=nginx999 nginx</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3、管理卷"><a href="#_3、管理卷" class="header-anchor">#</a> <a href="#_3%E3%80%81%E7%AE%A1%E7%90%86%E5%8D%B7">#</a> 3、管理卷</h3> <div class="language-text line-numbers-mode"><pre class="language-text"><code>docker volume create xxx：创建卷名
docker volume inspect xxx：查询卷详情
docker volume ls: 列出所有卷
docker volume prune: 移除无用卷
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4、docker-cp"><a href="#_4、docker-cp" class="header-anchor">#</a> <a href="#_4%E3%80%81docker-cp">#</a> 4、docker cp</h3> <p>cp 的细节</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> <span class="token function">cp</span> <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> CONTAINER:SRC_PATH DEST_PATH<span class="token operator">|</span>- ：把容器里面的复制出来
<span class="token function">docker</span> <span class="token function">cp</span> <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> SRC_PATH<span class="token operator">|</span>- CONTAINER:DEST_PATH：把外部的复制进去
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><p>SRC_PATH 指定为一个<strong>文件</strong></p></li> <li><ul><li><p>DEST_PATH 不存在：文件名为 DEST_PATH ，内容为 SRC 的内容</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 复制index.html 到nginx的/usr/share/nginx/html/test/(test目录不存在)目录下</span>
<span class="token comment"># 不以斜杠结尾</span>
<span class="token function">docker</span> <span class="token function">cp</span> index.html nginx:/usr/share/nginx/html/test
<span class="token comment"># 文件名为 test 内容为index.html内容</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>DEST_PATH 不存在并且以 / 结尾：报错</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 复制index.html 到nginx的/usr/share/nginx/html/test/(test目录不存在)目录下</span>
<span class="token function">docker</span> <span class="token function">cp</span> index.html nginx:/usr/share/nginx/html/test/

<span class="token comment"># 报错</span>
no such directory
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>DEST_PATH 存在并且是文件：目标文件内容被替换为 SRC_PATH 的文件内容。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 如果test文件存在并且是文件 index.html内容会覆盖test文件的内容，文件名不变</span>
<span class="token function">docker</span> <span class="token function">cp</span> index.html nginx:/usr/share/nginx/html/test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>DEST_PATH 存在并且是目录：文件复制到目录内，文件名为 SRC_PATH 指定的名字</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 如果test文件存在并且是文件夹，index.html会复制到test目录下，文件名就是index.html</span>
<span class="token function">docker</span> <span class="token function">cp</span> index.html nginx:/usr/share/nginx/html/test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> <span class="token function">cp</span> <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> CONTAINER:SRC_PATH DEST_PATH<span class="token operator">|</span>- ：把容器里面的复制出来
<span class="token function">docker</span> <span class="token function">cp</span> <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> SRC_PATH<span class="token operator">|</span>- CONTAINER:DEST_PATH：把外部的复制进去
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>SRC_PATH 指定为一个<strong>目录</strong></p></li> <li><ul><li><p>DEST_PATH 不存在： DEST_PATH 创建文件夹，复制源文件夹内的所有内容</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># testdir 文件夹，容器内会创建文件夹，并复制文件夹内的所有内容</span>
<span class="token function">docker</span> <span class="token function">cp</span> testdir nginx:/usr/share/nginx/html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>DEST_PATH 存在是文件：报错</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 如果容器内testdir2是文件，会报错</span>
<span class="token function">docker</span> <span class="token function">cp</span> testdir2 nginx:/usr/share/nginx/html/testdir2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>DEST_PATH 存在是目录</p></li></ul></li> <li><ul><li><ul><li><p>SRC_PATH 不以 /. 结束：源文件夹复制到目标里面</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># testdir不以/.结束，会把testdir整个文件夹复制到testdir2里面去</span>
<span class="token function">docker</span> <span class="token function">cp</span> testdir nginx:/usr/share/nginx/html/testdir2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>SRC_PATH 以 /. 结束：源文件夹里面的内容复制到目标里面</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># testdir以/.结束，会把testdir文件夹里面的内容复制到testdir2里面去</span>
<span class="token function">docker</span> <span class="token function">cp</span> testdir/. nginx:/usr/share/nginx/html/testdir2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li></ul></li></ul> <p>自动创建文件夹不会做递归。把父文件夹做好</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 本地文件复制到容器</span>
<span class="token function">docker</span> <span class="token function">cp</span> index.html mynginx4:/usr/share/nginx/html

<span class="token comment"># 从容器中复制出来</span>
<span class="token function">docker</span> <span class="token function">cp</span> mynginx4:/etc/nginx/nginx.conf nginx.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_2、docker-网络"><a href="#_2、docker-网络" class="header-anchor">#</a> <a href="#_2%E3%80%81docker%E7%BD%91%E7%BB%9C">#</a> 2、Docker 网络</h2> <h3 id="_1、docker-启动后-网络情况"><a href="#_1、docker-启动后-网络情况" class="header-anchor">#</a> <a href="#_1%E3%80%81docker%E5%90%AF%E5%8A%A8%E5%90%8E-%E7%BD%91%E7%BB%9C%E6%83%85%E5%86%B5">#</a> 1、Docker 启动后，网络情况</h3> <p>会产生一个名为 <strong>docker0</strong> 的虚拟网桥</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 查看docker网络模式命令</span>
<span class="token function">docker</span> network <span class="token function">ls</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>容器间的互联和通信以及端口映射</strong></p> <p><strong>容器 IP 变动时候可以通过服务名直接网络通信而不受到影响</strong></p> <h3 id="_2、常用命令"><a href="#_2、常用命令" class="header-anchor">#</a> <a href="#_2%E3%80%81%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">#</a> 2、常用命令</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 所有命令</span>
<span class="token function">docker</span> network <span class="token parameter variable">--help</span>

<span class="token comment"># 创建网络</span>
<span class="token function">docker</span> network create XXX网络名字

<span class="token comment"># 查看网络</span>
<span class="token function">docker</span> network <span class="token function">ls</span>

<span class="token comment"># 查看网络源数据</span>
<span class="token function">docker</span> network inspect  XXX网络名字

<span class="token comment"># 删除网络</span>
<span class="token function">docker</span> network <span class="token function">rm</span> XXX网络名字
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> network create test_network

<span class="token function">docker</span> network <span class="token function">ls</span>

<span class="token function">docker</span> network <span class="token function">rm</span> test_network
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3、网络模式"><a href="#_3、网络模式" class="header-anchor">#</a> <a href="#_3%E3%80%81%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F">#</a> 3、网络模式</h3> <p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-8.w55yfnnagk0.webp" alt="image-20220109185946866"></p> <ul><li>bridge 模式：使用--network bridge 指定，默认使用 docker0</li> <li>host 模式：使用--network host 指定</li> <li>none 模式：使用--network none 指定</li> <li>container 模式：使用--network container:NAME 或者容器 ID 指定</li></ul> <p><strong>docker 容器内部的 ip 是有可能会发生改变的</strong></p> <h4 id="_1、bridge"><a href="#_1、bridge" class="header-anchor">#</a> <a href="#_1%E3%80%81bridge">#</a> 1、bridge</h4> <p>Docker 服务默认会创建一个 docker0 网桥（其上有一个 docker0 内部接口），该桥接网络的名称为 docker0，它在 <strong>内核层</strong> 连通了其他的物理或虚拟网卡，这就将所有容器和本地主机都放到 <strong>同一个物理网络</strong> 。Docker 默认指定了 docker0 接口 的 IP 地址和子网掩码， <strong>让主机和容器之间可以通过网桥相互通信</strong>。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 查看 bridge 网络的详细信息，并通过 grep 获取名称项</span>
<span class="token function">docker</span> network inspect bridge <span class="token operator">|</span> <span class="token function">grep</span> name

<span class="token function">ifconfig</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">docker</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>1、Docker 使用 Linux 桥接，在宿主机虚拟一个 Docker 容器网桥(docker0)，Docker 启动一个容器时会根据 Docker 网桥的网段分配给容器一个 IP 地址，称为 Container-IP，同时 Docker 网桥是每个容器的默认网关。因为在同一宿主机内的容器都接入同一个网桥，这样容器之间就能够通过容器的 Container-IP 直接通信。</p> <p>2、docker run 的时候，没有指定 network 的话默认使用的网桥模式就是 bridge，使用的就是 docker0 。在宿主机 ifconfig,就可以看到 docker0 和自己 create 的 network(后面讲)eth0，eth1，eth2……代表网卡一，网卡二，网卡三…… ，lo 代表 127.0.0.1，即 localhost ，inet addr 用来表示网卡的 IP 地址</p> <p>3、网桥 docker0 创建一对对等虚拟设备接口一个叫 veth，另一个叫 eth0，成对匹配。</p> <p>3.1 整个宿主机的网桥模式都是 docker0，类似一个交换机有一堆接口，每个接口叫 veth，在本地主机和容器内分别创建一个虚拟接口，并让他们彼此联通（这样一对接口叫 veth pair）；</p> <p>3.2 每个容器实例内部也有一块网卡，每个接口叫 eth0；</p> <p>3.3 docker0 上面的每个 veth 匹配某个容器实例内部的 eth0，两两配对，一一匹配。</p> <p>通过上述，将宿主机上的所有容器都连接到这个内部网络上，两个容器在同一个网络下,会从这个网关下各自拿到分配的 ip，此时两个容器的网络是互通的。</p> <p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-9.4k99sua2a840.webp" alt="image-20220109190456364"></p></blockquote> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8081</span>:8080   <span class="token parameter variable">--name</span> tomcat81 billygoo/tomcat8-jdk8
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8082</span>:8080   <span class="token parameter variable">--name</span> tomcat82 billygoo/tomcat8-jdk8

<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat81 <span class="token function">bash</span>
<span class="token function">ip</span> addr
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat82 <span class="token function">bash</span>
<span class="token function">ip</span> addr

<span class="token comment"># 查看 eth0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_2、host"><a href="#_2、host" class="header-anchor">#</a> <a href="#_2%E3%80%81host">#</a> 2、host</h4> <p>直接使用宿主机的 IP 地址与外界进行通信，不再需要额外进行 NAT 转换。</p> <p>容器将 不会获得 一个独立的 Network Namespace， 而是和宿主机共用一个 Network Namespace。 容器将不会虚拟出自己的网卡而是使用宿主机的 IP 和端口。</p> <p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-10.47g9hv7muzk0.webp" alt="image-20220109190711123"></p> <blockquote><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 警告</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8083</span>:8080 <span class="token parameter variable">--network</span> <span class="token function">host</span> <span class="token parameter variable">--name</span> tomcat83 billygoo/tomcat8-jdk8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>问题：</p> <p>docke 启动时总是遇见标题中的警告</p> <p>原因：</p> <p>docker 启动时指定--network=host 或-net=host，如果还指定了-p 映射端口，那这个时候就会有此警告，</p> <p>并且通过-p 设置的参数将不会起到任何作用，端口号会以主机端口号为主，重复时则递增。</p> <p>解决:</p> <p>解决的办法就是使用 docker 的其他网络模式，例如--network=bridge，这样就可以解决问题，或者直接无视.</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 正确</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--network</span> <span class="token function">host</span> <span class="token parameter variable">--name</span> tomcat83 billygoo/tomcat8-jdk8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>无之前的配对显示了，看容器实例内部</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> inspect tomcat83 <span class="token operator">|</span> <span class="token function">tail</span> <span class="token parameter variable">-n</span> <span class="token number">20</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-11.5yrsxwz3sms0.webp" alt="image-20220109190938880"></p> <p><strong>没有设置-p 的端口映射了，如何访问启动的 tomcat83？</strong></p> <p>http://宿主机 IP:8080/</p> <p>在 CentOS 里面用默认的火狐浏览器访问容器内的 tomcat83 看到访问成功，因为此时容器的 IP 借用主机的，</p> <p>所以容器共享宿主机网络 IP，这样的好处是外部主机与容器可以直接通信。</p></blockquote> <h4 id="_3、none"><a href="#_3、none" class="header-anchor">#</a> <a href="#_3%E3%80%81none">#</a> 3、none</h4> <p>在 none 模式下，并不为 Docker 容器进行任何网络配置。</p> <p>也就是说，这个 Docker 容器没有网卡、IP、路由等信息，只有一个 lo</p> <p>需要我们自己为 Docker 容器添加网卡、配置 IP 等。</p> <p><strong>禁用网络功能，只有 lo 标识(就是 127.0.0.1 表示本地回环)</strong></p> <blockquote><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8084</span>:8080 <span class="token parameter variable">--network</span> none <span class="token parameter variable">--name</span> tomcat84 billygoo/tomcat8-jdk8

<span class="token comment"># 进入容器内部查看</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat84 <span class="token operator">|</span> <span class="token function">tail</span> <span class="token parameter variable">-n</span> <span class="token number">20</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-12.5bj1jm7o2g0.webp" alt="image-20220109191146701"></p></blockquote> <h4 id="_4、container"><a href="#_4、container" class="header-anchor">#</a> <a href="#_4%E3%80%81container">#</a> 4、container</h4> <p>新建的容器和已经存在的一个容器共享一个网络 ip 配置而不是和宿主机共享。新创建的容器不会创建自己的网卡，配置自己的 IP，而是和一个指定的容器共享 IP、端口范围等。同样，两个容器除了网络方面，其他的如文件系统、进程列表等还是隔离的。</p> <p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-13.55myr4iwozg0.webp" alt="image-20220109191221754"></p> <blockquote><p>Alpine Linux 是一款独立的、非商业的通用 Linux 发行版，专为追求安全性、简单性和资源效率的用户而设计。 可能很多人没听说过这个 Linux 发行版本，但是经常用 Docker 的朋友可能都用过，因为他小，简单，安全而著称，所以作为基础镜像是非常好的一个选择，可谓是麻雀虽小但五脏俱全，镜像非常小巧，不到 6M 的大小，所以特别适合容器打包。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 正确</span>
<span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span> alpine1  alpine /bin/sh
<span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--network</span> container:alpine1 <span class="token parameter variable">--name</span> alpine2  alpine /bin/sh

<span class="token comment"># 运行结果，验证共用搭桥</span>
<span class="token comment"># 查看eth0</span>

<span class="token comment"># 假如此时关闭alpine1，再看看alpine2</span>
<span class="token function">ip</span> addr
<span class="token comment"># eth0消失了</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></blockquote> <h4 id="_5、自定义网络"><a href="#_5、自定义网络" class="header-anchor">#</a> <a href="#_5%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C">#</a> 5、自定义网络</h4> <p><strong>link 已过时</strong></p> <p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-14.613w4atbj2c0.webp" alt="image-20220109191749232"></p> <blockquote><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8081</span>:8080  <span class="token parameter variable">--name</span> tomcat81 billygoo/tomcat8-jdk8
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8082</span>:8080  <span class="token parameter variable">--name</span> tomcat82 billygoo/tomcat8-jdk8
<span class="token comment"># 上述成功启动并用docker exec进入各自容器实例内部</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat81 <span class="token function">bash</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat82 <span class="token function">bash</span>
<span class="token comment"># 按照IP地址ping是OK的</span>

<span class="token comment"># 按照服务名ping结果???</span>
<span class="token comment">## 不行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></blockquote> <blockquote><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 自定义桥接网络,自定义网络默认使用的是桥接网络bridge</span>
<span class="token comment"># 新建自定义网络</span>
<span class="token function">docker</span> network create xue_network

<span class="token comment"># 新建容器加入上一步新建的自定义网络</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8081</span>:8080 <span class="token parameter variable">--network</span> xue_network  <span class="token parameter variable">--name</span> tomcat81 billygoo/tomcat8-jdk8
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8082</span>:8080 <span class="token parameter variable">--network</span> xue_network  <span class="token parameter variable">--name</span> tomcat82 billygoo/tomcat8-jdk8

<span class="token comment"># 按照服务名ping是OK的</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>自定义网络本身就维护好了主机名和 ip 的对应关系（ip 和域名都能通）</strong></p> <p><strong>自定义网络本身就维护好了主机名和 ip 的对应关系（ip 和域名都能通）</strong></p> <p><strong>自定义网络本身就维护好了主机名和 ip 的对应关系（ip 和域名都能通）</strong></p></blockquote> <h3 id="_4、端口映射"><a href="#_4、端口映射" class="header-anchor">#</a> <a href="#_4%E3%80%81%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84">#</a> 4、端口映射</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> create <span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token parameter variable">--name</span> hello-mysql
mysql:5.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_5、容器互联"><a href="#_5、容器互联" class="header-anchor">#</a> <a href="#_5%E3%80%81%E5%AE%B9%E5%99%A8%E4%BA%92%E8%81%94">#</a> 5、容器互联</h3> <blockquote><p>--link name:alias ，name 连接容器的名称，alias 连接的别名</p></blockquote> <p>场景：我们无需暴露 mysql 的情况下，让 web 应用使用 mysql；</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token parameter variable">--name</span> mysql01 mysql:5.7
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--link</span> mysql01:mysql <span class="token parameter variable">--name</span> tomcat tomcat:7
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat <span class="token function">bash</span>
<span class="token function">cat</span> /etc/hosts
<span class="token function">ping</span> mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_6、自定义网络-原理"><a href="#_6、自定义网络-原理" class="header-anchor">#</a> <a href="#_6%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C-%E5%8E%9F%E7%90%86">#</a> 6、自定义网络（原理）</h3> <h4 id="_1、默认网络原理"><a href="#_1、默认网络原理" class="header-anchor">#</a> <a href="#_1%E3%80%81%E9%BB%98%E8%AE%A4%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86">#</a> 1、默认网络原理</h4> <p>Docker 使用 Linux 桥接，在宿主机虚拟一个 Docker 容器网桥(docker0)，Docker 启动一个容器时会根据 Docker 网桥的网段分配给容器一个 IP 地址，称为 Container-IP，同时 Docker 网桥是每个容器的默认网关。因为在同一宿主机内的容器都接入同一个网桥，这样容器之间就能够通过容器的 Container-IP 直接通信。</p> <p><img src="https://jsd.cdn.zzko.cn/gh/knightxv/image-hosting@master/20230116/4-15.1k1chpmay268.webp" alt="image-20210628115145108"></p> <p>Linux 虚拟网络技术。</p> <blockquote><p>Docker 容器网络就很好的利用了 Linux 虚拟网络技术，在本地主机和容器内分别创建一个虚拟接口，并让</p> <p>他们彼此联通（这样一对接口叫 veth pair）；</p> <p>Docker 中的网络接口默认都是虚拟的接口。虚拟接口的优势就是转发效率极高（因为 Linux 是在内核中进</p> <p>行数据的复制来实现虚拟接口之间的数据转发，无需通过外部的网络设备交换），对于本地系统和容器</p> <p>系统来说，虚拟接口跟一个正常的以太网卡相比并没有区别，只是他的速度快很多。</p></blockquote> <p>原理：</p> <p>1、每一个安装了 Docker 的 linux 主机都有一个 docker0 的虚拟网卡。桥接网卡</p> <p>2、每启动一个容器 linux 主机多了一个虚拟网卡。</p> <p>3、docker run -d -P --name tomcat --net bridge tomcat:8</p> <h4 id="_2、网络模式"><a href="#_2、网络模式" class="header-anchor">#</a> <a href="#_2%E3%80%81%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F">#</a> 2、网络模式</h4> <table><thead><tr><th>网络模式</th> <th>配置</th> <th>说明</th></tr></thead> <tbody><tr><td>bridge 模式</td> <td>--net=bridge</td> <td>默认值，在 Docker 网桥 docker0 上为容器创建新的网络栈</td></tr> <tr><td>none 模式</td> <td>--net=none</td> <td>不配置网络，用户可以稍后进入容器，自行配置</td></tr> <tr><td>container 模式</td> <td>--net=container:name/id</td> <td>容器和另外一个容器共享 Network namespace。kubernetes 中的 pod 就是多个容器共享一个 Network namespace。</td></tr> <tr><td>host 模式</td> <td>--net=host</td> <td>容器和宿主机共享 Network namespace</td></tr> <tr><td>用户自定义</td> <td>--net=自定义网络</td> <td>用户自己使用 network 相关命令定义网络,创建容器的时候可以指定为自己定义的网络</td></tr></tbody></table> <h4 id="_3、自建网络测试"><a href="#_3、自建网络测试" class="header-anchor">#</a> <a href="#_3%E3%80%81%E8%87%AA%E5%BB%BA%E7%BD%91%E7%BB%9C%E6%B5%8B%E8%AF%95">#</a> 3、自建网络测试</h4> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#1、docker0网络的特点。，</span>
默认、域名访问不通、--link 域名通了，但是删了又不行
<span class="token comment">#2、可以让容器创建的时候使用自定义网络</span>
<span class="token number">1</span>、自定义创建的默认default <span class="token string">&quot;bridge&quot;</span>
<span class="token number">2</span>、自定义创建一个网络网络
<span class="token function">docker</span> network create <span class="token parameter variable">--driver</span> bridge <span class="token parameter variable">--subnet</span> <span class="token number">192.168</span>.0.0/16 <span class="token parameter variable">--gateway</span> <span class="token number">192.168</span>.0.1 mynet
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span><span class="token operator">=</span>tomcat1 <span class="token parameter variable">--network</span><span class="token operator">=</span>mynet tomcat:jre8-alpine
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span><span class="token operator">=</span>redisserver <span class="token parameter variable">--network</span><span class="token operator">=</span>mynet redis
<span class="token comment"># 以上tomcat和redis可以互相ping通</span>
<span class="token comment"># 对于没有ping命令的容器可以这样测试</span>
<span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--network</span> container:redisserver alpine
<span class="token comment"># 所有东西实时维护好，直接域名ping通</span>
<span class="token function">docker</span> network connect <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> NETWORK CONTAINER
<span class="token comment">#3、跨网络连接别人就用。把tomcat加入到mynet网络</span>
<span class="token function">docker</span> network connect mynet tomcat
效果：
<span class="token number">1</span>、自定义网络，默认都可以用主机名访问通
<span class="token number">2</span>、跨网络连接别人就用 <span class="token function">docker</span> network connect mynet tomcat
<span class="token comment">#4、命令</span>
<span class="token number">1</span>、容器启动，指定容器ip。 <span class="token function">docker</span> run <span class="token parameter variable">--ip</span> <span class="token number">192.168</span>.0.3 <span class="token parameter variable">--net</span> 自定义网络
<span class="token number">2</span>、创建子网。docker network create <span class="token parameter variable">--subnet</span> 指定子网范围  <span class="token parameter variable">--driver</span> bridge 所有东西实时
维护好，直接域名ping同
<span class="token number">3</span>、docker compose 中的网络默认就是自定义网络方式
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_7、docker-平台架构"><a href="#_7、docker-平台架构" class="header-anchor">#</a> <a href="#_7%E3%80%81docker%E5%B9%B3%E5%8F%B0%E6%9E%B6%E6%9E%84">#</a> 7、Docker 平台架构</h3> <p>Docker 运行的基本流程为：</p> <ol><li>用户是使用 Docker Client 与 Docker Daemon 建立通信，并发送请求给后者。</li> <li>Docker Daemon 作为 Docker 架构中的主体部分，首先提供 Docker Server 的功能使其可以接受 Docker Client 的请求。</li> <li>Docker Engine 执行 Docker 内部的一系列工作，每一项工作都是以一个 Job 的形式的存在。</li> <li>Job 的运行过程中，当需要容器镜像时，则从 Docker Registry 中下载镜像，并通过镜像管理驱动 Graph driver 将下载镜像以 Graph 的形式存储。</li> <li>当需要为 Docker 创建网络环境时，通过网络管理驱动 Network driver 创建并配置 Docker 容器网络环境。</li> <li>当需要限制 Docker 容器运行资源或执行用户指令等操作时，则通过 Execdriver 来完成。</li> <li>Libcontainer 是一项独立的容器管理包，Network driver 以及 Exec driver 都是通过 Libcontainer 来实现具体对容器进行的操作。</li></ol></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/knightxv/edit/master/docs/04.云原生/00.云原生/02.Docker/00.docker基础/04.网络和存储原理.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/01/18, 01:34:59</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/37754f/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Docker安装基本应用</div></a> <a href="/pages/a4468b/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">深入Dockerfile</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/37754f/" class="prev">Docker安装基本应用</a></span> <span class="next"><a href="/pages/a4468b/">深入Dockerfile</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/19f069/"><div>
            进程的状态
            <!----></div></a> <span class="date">02-02</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/646840/"><div>
            进程调度策略
            <!----></div></a> <span class="date">02-02</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/5a20ab/"><div>
            线程的分类
            <!----></div></a> <span class="date">02-02</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:962068006@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/knightxv" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>Evan Xu | <a href="https://github.com/knightxv/knightxv/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.478b25db.js" defer></script><script src="/assets/js/2.19704705.js" defer></script><script src="/assets/js/64.bbbca609.js" defer></script>
  </body>
</html>
